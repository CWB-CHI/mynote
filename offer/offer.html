<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>offer</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; tab-size: 4; background-position: inherit inherit; background-repeat: inherit inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.701961); color: rgb(85, 85, 85); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror-linenumber { }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit inherit; background-repeat: inherit inherit; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; background-position: 0px 0px; background-repeat: initial initial; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print { 
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid-page; break-before: avoid-page; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid-page; }
  .typora-export #write::after { height: 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; overflow-x: hidden; background-position: initial initial; background-repeat: initial initial; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background-color: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; background-position: initial initial; background-repeat: initial initial; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { white-space: pre !important; border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; text-shadow: initial !important; background-position: 0px 0px !important; background-repeat: initial initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; white-space: nowrap; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; border: none !important; background-position: 0px 0px !important; background-repeat: initial initial !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: 0px 0px; background-repeat: initial initial; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); background-position: initial initial; background-repeat: initial initial; }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}
#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}
#write {
    counter-reset: h1
}

h1 {
    counter-reset: h2
}

h2 {
    counter-reset: h3
}

h3 {
    counter-reset: h4
}

h4 {
    counter-reset: h5
}

h5 {
    counter-reset: h6
}

/** put counter result into headings */
#write h1:before {
    counter-increment: h1;
    content: counter(h1) ". "
}

#write h2:before {
    counter-increment: h2;
    content: counter(h1) "." counter(h2) ". "
}

#write h3:before,
h3.md-focus.md-heading:before /** override the default style for focused headings */ {
    counter-increment: h3;
    content: counter(h1) "." counter(h2) "." counter(h3) ". "
}

#write h4:before,
h4.md-focus.md-heading:before {
    counter-increment: h4;
    content: counter(h1) "." counter(h2) "." counter(h3) "." counter(h4) ". "
}

#write h5:before,
h5.md-focus.md-heading:before {
    counter-increment: h5;
    content: counter(h1) "." counter(h2) "." counter(h3) "." counter(h4) "." counter(h5) ". "
}

#write h6:before,
h6.md-focus.md-heading:before {
    counter-increment: h6;
    content: counter(h1) "." counter(h2) "." counter(h3) "." counter(h4) "." counter(h5) "." counter(h6) ". "
}

/** override the default style for focused headings */
#write>h3.md-focus:before,
#write>h4.md-focus:before,
#write>h5.md-focus:before,
#write>h6.md-focus:before,
h3.md-focus:before,
h4.md-focus:before,
h5.md-focus:before,
h6.md-focus:before {
    color: inherit;
    border: inherit;
    border-radius: inherit;
    position: inherit;
    left:initial;
    float: none;
    top:initial;
    font-size: inherit;
    padding-left: inherit;
    padding-right: inherit;
    vertical-align: inherit;
    font-weight: inherit;
    line-height: inherit;
}
 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-mac'><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n2"><a class="md-toc-inner" href="#网络">网络</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n3"><a class="md-toc-inner" href="#双工术语">双工术语</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n5"><a class="md-toc-inner" href="#全双工">全双工</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n7"><a class="md-toc-inner" href="#半双工">半双工</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n9"><a class="md-toc-inner" href="#单工">单工</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n12"><a class="md-toc-inner" href="#tcp">TCP</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n24"><a class="md-toc-inner" href="#tcp报文头20个字节">TCP报文头【20个字节】</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n35"><a class="md-toc-inner" href="#三次握手">三次握手</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n45"><a class="md-toc-inner" href="#syn超时">SYN超时</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n55"><a class="md-toc-inner" href="#四次挥手">四次挥手</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n69"><a class="md-toc-inner" href="#tcp滑动窗口">TCP滑动窗口</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n77"><a class="md-toc-inner" href="#udp">UDP</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n92"><a class="md-toc-inner" href="#udp报文头8个字节">UDP报文头【8个字节】</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n95"><a class="md-toc-inner" href="#tcp和udp区别">TCP和UDP区别</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n106"><a class="md-toc-inner" href="#http">HTTP</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n107"><a class="md-toc-inner" href="#请求结构">请求结构 </a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n110"><a class="md-toc-inner" href="#响应结构">响应结构</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n114"><a class="md-toc-inner" href="#请求响应步骤">请求响应步骤</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n127"><a class="md-toc-inner" href="#浏览器输入url后流程">浏览器输入URL后，流程</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n142"><a class="md-toc-inner" href="#http状态码">HTTP状态码</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n145"><a class="md-toc-inner" href="#get-post区别">GET POST区别</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n150"><a class="md-toc-inner" href="#http-和-https">HTTP 和 HTTPS</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n160"><a class="md-toc-inner" href="#加密方式">加密方式</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n171"><a class="md-toc-inner" href="#https传输流程">HTTPS传输流程</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n184"><a class="md-toc-inner" href="#区别">区别</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n195"><a class="md-toc-inner" href="#数据库">数据库</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n196"><a class="md-toc-inner" href="#关系型数据库设计">关系型数据库设计</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n220"><a class="md-toc-inner" href="#索引">索引</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n234"><a class="md-toc-inner" href="#b-tree">B-Tree</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n255"><a class="md-toc-inner" href="#btree">B+Tree</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n257"><a class="md-toc-inner" href="#b树与b-树的区别">B+树与B-树的区别</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n268"><a class="md-toc-inner" href="#hash索引">Hash索引</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n282"><a class="md-toc-inner" href="#索引分类">索引分类</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n283"><a class="md-toc-inner" href="#innodb索引">InnoDB索引</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n292"><a class="md-toc-inner" href="#密集索引和稀疏索引">密集索引和稀疏索引</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n307"><a class="md-toc-inner" href="#聚簇索引和非聚簇索引-不是一种单独的索引类型而是根据存储方式划分的种类">聚簇索引和非聚簇索引 [不是一种单独的索引类型，而是根据存储方式划分的种类]</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n313"><a class="md-toc-inner" href="#优化慢查询">优化慢查询</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n322"><a class="md-toc-inner" href="#联合索引的最左匹配原则">联合索引的最左匹配原则</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n326"><a class="md-toc-inner" href="#锁">锁</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n327"><a class="md-toc-inner" href="#种类">种类</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n348"><a class="md-toc-inner" href="#表级锁-行级锁">表级锁 行级锁</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n365"><a class="md-toc-inner" href="#acid事务四大特性">ACID事务四大特性</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n371"><a class="md-toc-inner" href="#不同的隔离级别和问题">不同的隔离级别和问题</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n399"><a class="md-toc-inner" href="#innodb-默认事务隔离级别rr如何避免幻读">InnoDB 默认事务隔离级别RR如何避免幻读</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n401"><a class="md-toc-inner" href="#使用快照读-一定程度避免幻读">使用快照读 一定程度避免幻读</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n409"><a class="md-toc-inner" href="#快照怎么实现-mvcc">快照怎么实现? MVCC</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n415"><a class="md-toc-inner" href="#使用next-key锁-避免当前读产生的幻读">使用next-key锁 避免当前读产生的幻读</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n430"><a class="md-toc-inner" href="#gap锁">Gap锁 </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n456"><a class="md-toc-inner" href="#范式">范式</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n457"><a class="md-toc-inner" href="#第一范式">第一范式</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n459"><a class="md-toc-inner" href="#第二范式">第二范式</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n461"><a class="md-toc-inner" href="#第三范式">第三范式</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n464"><a class="md-toc-inner" href="#分表-分区-分库">分表 分区 分库</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n465"><a class="md-toc-inner" href="#分表-分区">分表 分区</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n469"><a class="md-toc-inner" href="#jvm">JVM</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n470"><a class="md-toc-inner" href="#面试题">面试题 </a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n471"><a class="md-toc-inner" href="#对java的理解">对java的理解</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n474"><a class="md-toc-inner" href="#平台无关性">平台无关性</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n477"><a class="md-toc-inner" href="#什么是反射">什么是反射</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n480"><a class="md-toc-inner" href="#jvm结构">JVM结构 </a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n493"><a class="md-toc-inner" href="#jvm内存模型">JVM内存模型</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n495"><a class="md-toc-inner" href="#程序计数器-pc-register">程序计数器 PC Register</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n508"><a class="md-toc-inner" href="#虚拟机栈-jvm-stack">虚拟机栈 JVM Stack</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n524"><a class="md-toc-inner" href="#栈帧">栈帧</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n538"><a class="md-toc-inner" href="#本地方法栈-native-method-stack">本地方法栈 Native Method Stack</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n549"><a class="md-toc-inner" href="#堆-heap">堆 Heap</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n562"><a class="md-toc-inner" href="#新生代和老年代">新生代和老年代</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n565"><a class="md-toc-inner" href="#堆栈大小参数调优">堆栈大小参数调优</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n573"><a class="md-toc-inner" href="#方法区-method-area">方法区 Method Area</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n584"><a class="md-toc-inner" href="#方法区的一种实现-永久代permgen-space">方法区的一种实现 永久代PermGen Space</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n587"><a class="md-toc-inner" href="#永久代permgen和元空间metaspacehttpswwwcnblogscompaddixp5309550html">永久代(PermGen)和元空间(Metaspace)</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n590"><a class="md-toc-inner" href="#常量池">常量池</a></span><span role="listitem" class="md-toc-item md-toc-h5" data-ref="n593"><a class="md-toc-inner" href="#string-intern-在不同jdk版本的区别">String intern 在不同JDK版本的区别</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n598"><a class="md-toc-inner" href="#jvm如何加载class文件">JVM如何加载class文件? </a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n599"><a class="md-toc-inner" href="#类的加载过程">类的加载过程</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n608"><a class="md-toc-inner" href="#类加载器classloader">类加载器ClassLoader</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n611"><a class="md-toc-inner" href="#类加载器种类">类加载器种类</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n622"><a class="md-toc-inner" href="#双亲委派模型-parents-delegation-model">双亲委派模型 [Parents Delegation Model]</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n646"><a class="md-toc-inner" href="#classloader对象loadclass-和-classforname-区别">ClassLoader对象loadClass 和 Class.forName 区别</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n650"><a class="md-toc-inner" href="#gc">GC</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n651"><a class="md-toc-inner" href="#引用类型">引用类型</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n679"><a class="md-toc-inner" href="#判断对象生存还是死亡">判断对象生存还是死亡</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n680"><a class="md-toc-inner" href="#引用计数算法">引用计数算法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n684"><a class="md-toc-inner" href="#可达性分析算法java使用此算法">可达性分析算法[Java使用此算法]</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n697"><a class="md-toc-inner" href="#被回收的对象">被回收的对象</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n700"><a class="md-toc-inner" href="#finalize方法">finalize方法</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n710"><a class="md-toc-inner" href="#垃圾回收算法">垃圾回收算法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n711"><a class="md-toc-inner" href="#标记-清除算法-mark-and-sweep">标记-清除算法 Mark and Sweep</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n726"><a class="md-toc-inner" href="#复制算法-copying">复制算法 Copying</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n735"><a class="md-toc-inner" href="#标记-整理-mark-compact">标记-整理 Mark-Compact</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n740"><a class="md-toc-inner" href="#分代收集算法-generational-collector">分代收集算法 Generational Collector</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n750"><a class="md-toc-inner" href="#minor-gc-和-major-gc-full-gc">Minor GC 和 Major GC/ Full GC</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n763"><a class="md-toc-inner" href="#对象分配策略">对象分配策略</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n764"><a class="md-toc-inner" href="#新生对象分配到新生代的eden区">新生对象分配到新生代的Eden区</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n776"><a class="md-toc-inner" href="#对象从新生代晋升到老年代">对象从新生代晋升到老年代</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n787"><a class="md-toc-inner" href="#垃圾回收器garbage-collectors--垃圾回收算法的实现">垃圾回收器Garbage Collectors  [垃圾回收算法的实现]</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n788"><a class="md-toc-inner" href="#stop-the-world-stw">Stop-the-world [STW]</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n791"><a class="md-toc-inner" href="#oopmapordinary-object-pointer-map">OopMap[Ordinary Object Pointer Map]</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n794"><a class="md-toc-inner" href="#安全点safepoint">安全点[Safepoint]</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n804"><a class="md-toc-inner" href="#垃圾回收器分类">垃圾回收器分类</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n809"><a class="md-toc-inner" href="#新生代的垃圾回收器">新生代的垃圾回收器 </a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n810"><a class="md-toc-inner" href="#serial">Serial</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n820"><a class="md-toc-inner" href="#parnew">ParNew</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n830"><a class="md-toc-inner" href="#parallel-scavenge">Parallel Scavenge</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n852"><a class="md-toc-inner" href="#老年代的垃圾回收器">老年代的垃圾回收器 </a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n853"><a class="md-toc-inner" href="#serial-old">Serial Old</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n863"><a class="md-toc-inner" href="#parallel-old">Parallel Old</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n872"><a class="md-toc-inner" href="#cmsconcurrent-mark-sweep">CMS[Concurrent Mark Sweep]</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n892"><a class="md-toc-inner" href="#g1garbage-first">G1[Garbage First]</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n903"><a class="md-toc-inner" href="#垃圾回收参数调优">垃圾回收参数调优</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n909"><a class="md-toc-inner" href="#各个回收器组合">各个回收器组合</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n910"><a class="md-toc-inner" href="#-xxuseserialgc">-XX:+UseSerialGC</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n912"><a class="md-toc-inner" href="#-xxuseparnewgc">-XX:+UseParNewGC</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n914"><a class="md-toc-inner" href="#-xxuseparallelgc">-XX:+UseParallelGC</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n916"><a class="md-toc-inner" href="#-xxuseparalleloldgc">-XX:+UseParallelOldGC</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n918"><a class="md-toc-inner" href="#-xxuseconcmarksweepgc">-XX:+UseConcMarkSweepGC</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n921"><a class="md-toc-inner" href="#jvm默认参数-gc回收器">JVM默认参数 GC回收器</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n925"><a class="md-toc-inner" href="#多线程与并发">多线程与并发</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n926"><a class="md-toc-inner" href="#面试题-n926">面试题</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n927"><a class="md-toc-inner" href="#thread中start和run方法的区别">Thread中start和run方法的区别</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n929"><a class="md-toc-inner" href="#thread-和-runnable-的区别">Thread 和 Runnable 的区别</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n931"><a class="md-toc-inner" href="#如何给run传参数">如何给run传参数</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n939"><a class="md-toc-inner" href="#处理线程返回值">处理线程返回值</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n947"><a class="md-toc-inner" href="#sleep和wait区别">sleep和wait区别</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n955"><a class="md-toc-inner" href="#notify-和-notifyall-区别">notify 和 notifyAll 区别</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n956"><a class="md-toc-inner" href="#锁池-entrylist">锁池 EntryList</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n958"><a class="md-toc-inner" href="#等待池-waitset">等待池 WaitSet</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n962"><a class="md-toc-inner" href="#theadyield">Thead.yield()</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n964"><a class="md-toc-inner" href="#threadinterrupt">Thread.interrupt()</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n974"><a class="md-toc-inner" href="#如何中断线程">如何中断线程</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n981"><a class="md-toc-inner" href="#java中线程状态">Java中线程状态</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1008"><a class="md-toc-inner" href="#synchronized底层实现原理">synchronized底层实现原理</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1009"><a class="md-toc-inner" href="#monitor">Monitor</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1022"><a class="md-toc-inner" href="#重入">重入</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1026"><a class="md-toc-inner" href="#hotspot对锁的优化">HotSpot对锁的优化</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1027"><a class="md-toc-inner" href="#synchronized的4种状态">synchronized的4种状态</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1052"><a class="md-toc-inner" href="#自旋锁和自适应自旋">自旋锁和自适应自旋</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1060"><a class="md-toc-inner" href="#锁消除">锁消除</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1063"><a class="md-toc-inner" href="#锁粗化">锁粗化</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1067"><a class="md-toc-inner" href="#偏向锁">偏向锁</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1073"><a class="md-toc-inner" href="#reentrantlock-再入锁">ReentrantLock 再入锁</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1090"><a class="md-toc-inner" href="#java内存模型-jmm">Java内存模型 JMM</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1101"><a class="md-toc-inner" href="#指令重排序">指令重排序</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1110"><a class="md-toc-inner" href="#happens-before">Happens-before</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1129"><a class="md-toc-inner" href="#volatile">volatile</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1130"><a class="md-toc-inner" href="#volatile的可见性">volatile的可见性</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1140"><a class="md-toc-inner" href="#单例类的双重检验">单例类的双重检验</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1144"><a class="md-toc-inner" href="#volatile-和--synchronized的区别">volatile 和  synchronized的区别</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1155"><a class="md-toc-inner" href="#cas-compare-and-swap">CAS [Compare and Swap]</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1158"><a class="md-toc-inner" href="#aba问题">ABA问题</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1161"><a class="md-toc-inner" href="#线程池">线程池</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1162"><a class="md-toc-inner" href="#为什么会用线程池">为什么会用线程池</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1164"><a class="md-toc-inner" href="#java线程池框架">Java线程池框架</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1168"><a class="md-toc-inner" href="#executor接口">Executor接口</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1172"><a class="md-toc-inner" href="#executorservice接口">ExecutorService接口</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1175"><a class="md-toc-inner" href="#scheduledexecutorservice接口">ScheduledExecutorService接口</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1178"><a class="md-toc-inner" href="#executors">Executors</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1204"><a class="md-toc-inner" href="#java异常">Java异常</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1205"><a class="md-toc-inner" href="#异常机制主要回答三个问题">异常机制主要回答三个问题</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1210"><a class="md-toc-inner" href="#异常体系">异常体系</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1214"><a class="md-toc-inner" href="#集合">集合</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1219"><a class="md-toc-inner" href="#hashmap">HashMap</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1222"><a class="md-toc-inner" href="#减少hash碰撞">减少hash碰撞</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1225"><a class="md-toc-inner" href="#为什么map大小总是2n">为什么Map大小总是<span class="math-in-toc">${2^n}$</span></a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1230"><a class="md-toc-inner" href="#putk-key-v-val">put(K key, V val)</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1247"><a class="md-toc-inner" href="#使hashmap线程安全">使HashMap线程安全</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1250"><a class="md-toc-inner" href="#concurrenthashmap">ConcurrentHashMap</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1255"><a class="md-toc-inner" href="#putk-key-v-val-n1255">put(K key, V Val)</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1274"><a class="md-toc-inner" href="#juc包">JUC包</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1288"><a class="md-toc-inner" href="#并发工具类">并发工具类</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1299"><a class="md-toc-inner" href="#countdownlatch">CountDownLatch</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1303"><a class="md-toc-inner" href="#cyclicbarrier">CyclicBarrier</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1307"><a class="md-toc-inner" href="#semaphore">Semaphore</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1311"><a class="md-toc-inner" href="#exchanger">Exchanger</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1316"><a class="md-toc-inner" href="#并发集合类">并发集合类</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1317"><a class="md-toc-inner" href="#blockingqueue">BlockingQueue</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1320"><a class="md-toc-inner" href="#实现类-都是线程安全的">实现类 都是线程安全的。</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1337"><a class="md-toc-inner" href="#io">IO</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1338"><a class="md-toc-inner" href="#bio-阻塞io">BIO 阻塞IO</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1341"><a class="md-toc-inner" href="#nio-非阻塞io">NIO 非阻塞IO</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1344"><a class="md-toc-inner" href="#channel">Channel</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1353"><a class="md-toc-inner" href="#buffer">Buffer</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1365"><a class="md-toc-inner" href="#selector-io多路复用">Selector IO多路复用</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1393"><a class="md-toc-inner" href="#aio-异步io">AIO 异步IO</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1395"><a class="md-toc-inner" href="#对比">对比</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1423"><a class="md-toc-inner" href="#spring">Spring</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1424"><a class="md-toc-inner" href="#特点">特点</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1425"><a class="md-toc-inner" href="#spring优点">Spring优点</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1428"><a class="md-toc-inner" href="#spring中的模块">Spring中的模块</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1431"><a class="md-toc-inner" href="#依赖倒置控制反转iocioc容器依赖注入di-的关系">依赖倒置&amp;控制反转[IOC]&amp;IOC容器&amp;依赖注入DI 的关系</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1446"><a class="md-toc-inner" href="#srping-ioc">Srping IOC</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1449"><a class="md-toc-inner" href="#ioc初始化过程">IOC初始化过程</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1461"><a class="md-toc-inner" href="#spring-ioc容器的核心接口">Spring IOC容器的核心接口</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1462"><a class="md-toc-inner" href="#beanfactory">BeanFactory</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1472"><a class="md-toc-inner" href="#beanfactory体系结构">BeanFactory体系结构</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1477"><a class="md-toc-inner" href="#applicationcontext">ApplicationContext</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1479"><a class="md-toc-inner" href="#beandefinition">BeanDefinition</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1481"><a class="md-toc-inner" href="#beandefinitionregistry">BeanDefinitionRegistry</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1490"><a class="md-toc-inner" href="#spring-bean">Spring Bean</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1491"><a class="md-toc-inner" href="#作用域">作用域</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1503"><a class="md-toc-inner" href="#bean生命周期">Bean生命周期</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1504"><a class="md-toc-inner" href="#创建过程">创建过程</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1520"><a class="md-toc-inner" href="#销毁过程">销毁过程</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1527"><a class="md-toc-inner" href="#spring-aop">Spring AOP</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1528"><a class="md-toc-inner" href="#aop的3中织入方法">AOP的3中织入方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1536"><a class="md-toc-inner" href="#主要名词">主要名词</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1540"><a class="md-toc-inner" href="#spring-事务">Spring 事务</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1541"><a class="md-toc-inner" href="#事务">事务</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1568"><a class="md-toc-inner" href="#隔离级别">隔离级别</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1589"><a class="md-toc-inner" href="#linux">Linux</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1590"><a class="md-toc-inner" href="#查找文件命令-find">查找文件命令 find</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1591"><a class="md-toc-inner" href="#管道操作符-">管道操作符 |</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1594"><a class="md-toc-inner" href="#筛选内容命令-grep">筛选内容命令 grep</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1595"><a class="md-toc-inner" href="#-o-pattern-不显示整行只显示匹配区域的内容">-o "pattern" 不显示整行，只显示匹配区域的内容</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1596"><a class="md-toc-inner" href="#-v-pattern-过滤匹配的行不显示">-v "pattern" 过滤匹配的行不显示</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1597"><a class="md-toc-inner" href="#awk">awk </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1600"><a class="md-toc-inner" href="#sed">sed</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1602"><a class="md-toc-inner" href="#pipeline">pipeline</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1605"><a class="md-toc-inner" href="#redis">Redis</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1606"><a class="md-toc-inner" href="#面试题-n1606">面试题</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1607"><a class="md-toc-inner" href="#海量key中查询出某一个固定前缀的key">海量key中查询出某一个固定前缀的key</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1613"><a class="md-toc-inner" href="#如何通过redis实现分布式锁">如何通过Redis实现分布式锁</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1614"><a class="md-toc-inner" href="#setnx">setnx</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1618"><a class="md-toc-inner" href="#set">set</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1620"><a class="md-toc-inner" href="#大量key同时过期">大量key同时过期</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1623"><a class="md-toc-inner" href="#如何hs用redis做异步队列">如何hs用Redis做异步队列</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1624"><a class="md-toc-inner" href="#rpushlpopblpop">rpush+lpop/blpop</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1628"><a class="md-toc-inner" href="#publish-subscribe">publish subscribe</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1632"><a class="md-toc-inner" href="#redis如何做持久化">Redis如何做持久化</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1633"><a class="md-toc-inner" href="#rdb-快照持久化">RDB 快照持久化</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1637"><a class="md-toc-inner" href="#aof-保存写状态持久化">AOF 保存写状态持久化</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1640"><a class="md-toc-inner" href="#rdb-aof混合持久化方式">RDB-AOF混合持久化方式</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1642"><a class="md-toc-inner" href="#redis-数据恢复">Redis 数据恢复</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1644"><a class="md-toc-inner" href="#rdb-aof优缺点">RDB AOF优缺点</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1650"><a class="md-toc-inner" href="#memcache和redis区别">Memcache和Redis区别</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1672"><a class="md-toc-inner" href="#为什么redis这么快">为什么Redis这么快</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1682"><a class="md-toc-inner" href="#file-descriptor-fd">File Descriptor [FD]</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1685"><a class="md-toc-inner" href="#数据类型">数据类型</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1697"><a class="md-toc-inner" href="#命令">命令</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1698"><a class="md-toc-inner" href="#key相关">key相关</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1700"><a class="md-toc-inner" href="#string-相关">String 相关</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1706"><a class="md-toc-inner" href="#hash-相关">hash 相关</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1711"><a class="md-toc-inner" href="#list-相关">list 相关</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1714"><a class="md-toc-inner" href="#set相关">set相关</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1720"><a class="md-toc-inner" href="#sorted-set相关">sorted set相关</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1724"><a class="md-toc-inner" href="#maven">Maven</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1725"><a class="md-toc-inner" href="#生命周期">生命周期</a></span></p></div><h1><a name="网络" class="md-header-anchor"></a><span>网络</span></h1><h2><a name="双工术语" class="md-header-anchor"></a><span>双工术语</span></h2><p><img src="img/单双工.png" alt="image-20191007224314021" style="zoom:50%;" /></p><h3><a name="全双工" class="md-header-anchor"></a><span>全双工</span></h3><p><span>允许数据在两个方向上同时传输。</span></p><h3><a name="半双工" class="md-header-anchor"></a><span>半双工</span></h3><p><span>数据可以两个方向上传输，但是不能同时传输。</span></p><h3><a name="单工" class="md-header-anchor"></a><span>单工</span></h3><p><span>数据只可以单向传输。</span></p><p>&nbsp;</p><h2><a name="tcp" class="md-header-anchor"></a><span>TCP</span></h2><p><span>简介：</span></p><ol start='' ><li><p><strong><span>面向连接的</span></strong><span>、</span><strong><span>可靠的</span></strong><span>、基于字节流的传输层通信协议</span></p></li><li><p><span>将应用层数据</span><strong><span>分割成报文</span></strong><span>段并发送给目标节点的TCP层</span></p></li><li><p><span>数据包有序号，对方收到则发送ACK确认，没收到ACK报文则重传</span></p></li><li><p><span>checksum[校验和]来校验，发送和接收都要计算</span></p><p><span> </span></p></li></ol><h3><a name="tcp报文头20个字节" class="md-header-anchor"></a><span>TCP报文头【20个字节】</span></h3><p><strong><span>源端口、目的端口【source port 、destination port 】：</span></strong>
<span>各占2个字节，所以端口号最大值65,535。TCP、UDP都不包含IP地址信息，只有端口来标识进程。计算机本地进程可以依靠唯一的进程PID来标识，但是远程两台机器PID不唯一，要依靠源端口、目的端口来标识。【IP层ip地址用来唯一标识主机，传输层端口号标识唯一进程】</span></p><p><strong><span>序号【sequence number】：</span></strong>
<span>占4个字节。报文的序号。</span></p><p><strong><span>ACK number：</span></strong>
<span>占4个字节。ACK报文中使用。此数值表示期望下一个收到的报文的序号值。</span></p><p><strong><span>offset：</span></strong>
<span>占1个字节。表示TCP报文的数据距离TCP报文的开始有多远，中间有TCP报文头。</span></p><p><strong><span>TCP flags：</span></strong>
<span>占1个字节。共8个标志位。</span>
<span>	</span><span>URG:紧急指针标志</span>
<span>x  ACK:确认序号标志。0:报文中不含确认信息，忽略ACK number字段</span>
<span>	</span><span>PSH:1:报文会被直接push到应用层，而不在缓冲区等待</span>
<span>	</span><span>RST:重置连接标志。</span>
<span>x  SYN:同步序列号，用于建立连接。[SYN=1无数据。]</span>
<span>x  FIN:finish标志。用于释放连接。</span></p><p><strong><span>window：</span></strong>
<span>占2个字节。表示滑动窗口大小，发送数据的速率。</span></p><p><strong><span>Checksum：</span></strong>
<span>占2个字节。奇偶校验，对整个报文段TCP头部和数据进行计算。</span></p><p><strong><span>Urgent Pointer：</span></strong>
<span>占2个字节。URG=1时有用，表示紧急数据的大小。</span></p><p><strong><span>TCP Options</span></strong></p><p>&nbsp;</p><h3><a name="三次握手" class="md-header-anchor"></a><span>三次握手</span></h3><ol start='' ><li><span>A发送连接请求报文，[SYN=1,ACK=0,seq=x x为任意整数]。连接状态从关闭【closed】到同步信息发送【 SYN-SENT】。</span></li><li><span>B接收到请求。连接状态从关闭、监听到同步接受【SYN-RCVD】。并且发送回馈报文[SYN=1,ACK=1,seq=y y为任意整数, ack=x+1]。</span></li><li><span>A接受到报文。转态转为连接已建立[ESTABLISHED] 。并返回报文[SYN=0,ACK=1,seq=x+1,ack=y+1]。B接受到报文。转态转为连接已建立。</span></li></ol><p><img src="img/三次握手.png" alt="image-2019091917312523" style="zoom:25%;" /></p><p><span>1、2报文段不可携带数据。即SYN=1。但3可以携带，也可不带。</span></p><h4><a name="syn超时" class="md-header-anchor"></a><span>SYN超时</span></h4><p><span>问题：</span></p><ol start='' ><li><span>Server收到SYN，并且回复了SYN-ACK，但没收到Client的ACK。此时连接未失败也没成功。</span><strong><span>解决方案</span></strong><span>：设置了时间，超时算失败。</span></li><li><span>SYN Flood。攻击者在超时前，用多个不同机器发送SYN请求连接，使请求队列满了，不可接受更多请求。</span><strong><span>解决方案：</span></strong><span>SYN队列满后，设置tcp_syncookies参数，如果其他计算机回发次参数，即使不在SYN队列中，也可以建立连接。</span></li><li><span>机器故障。机器会通过发送报文，检测对方机器是否正常，如果没有回复则认为机器不正常，断开连接。</span></li></ol><p>&nbsp;</p><h3><a name="四次挥手" class="md-header-anchor"></a><span>四次挥手</span></h3><ol start='' ><li><span>A已无数据需要发送，因此向B发送关闭连接请求[FIN=1, seq=u]状态从Established转到Fin-wait1</span></li><li><span>B收到后，回复[ACK=1, seq=v, ack=u+1]，转态转为close-wait。A收到后，状态转为Fin-wait2，等待B发送剩余数据。</span></li><li><span>B在发送完数据后，发送[FIN=1,ACK=1,seq=w,ack=u+1]，转态转为Last-ACK</span></li><li><span>A回复[ACK=1,seq=u+1,ack=w+1]，状态转为Time-wait在一段时间后转为Closed。B在收到回复后转为Closed转态。</span></li></ol><p><img src="img/四次分手.png" alt="image-20190919202359445" style="zoom:35%;" /></p><p><span>Time-wait转态作用：确保被动关闭连接方收到第四次挥手的ACK，如果没收到被动方会再次发送Fin报文。</span></p><p><span>被动关闭连接方一直处于Close-wait状态：可能是程序没发送ACK回复，这可能造成过多资源一直被占用，然后无法建立新连接。</span></p><p>&nbsp;</p><h3><a name="tcp滑动窗口" class="md-header-anchor"></a><span>TCP滑动窗口</span></h3><p><span>作用：</span></p><ol start='' ><li><span>保证可靠性。乱序重排</span></li><li><span>TCP流量控制</span></li></ol><p>&nbsp;</p><h2><a name="udp" class="md-header-anchor"></a><span>UDP</span></h2><p><span>简介：</span></p><ol start='' ><li><span>面向非连接。</span></li><li><span>不维护连接，支持同时向多个客户发送相同消息。</span></li><li><span>报头数据占</span><strong><span>8个字节</span></strong><span>。额外开销小。</span></li><li><span>吞吐量不受拥挤控制算法的调节。</span></li><li><span>尽最大努力交付，不保证可靠</span></li><li><span>面向报文，不对报文信息进行拆分、合并。应用程序需要控制报文大小。</span></li></ol><h3><a name="udp报文头8个字节" class="md-header-anchor"></a><span>UDP报文头【8个字节】</span></h3><p><span>源端口、目的端口：</span>
<span>各占2个字节。</span></p><p>&nbsp;</p><h2><a name="tcp和udp区别" class="md-header-anchor"></a><span>TCP和UDP区别</span></h2><ol start='' ><li><span>面向连接vs非面向连接</span></li><li><span>可靠vs不可靠</span></li><li><span>有序性vs无序性</span></li><li><span>慢vs快</span></li></ol><p>&nbsp;</p><h2><a name="http" class="md-header-anchor"></a><span>HTTP</span></h2><h3><a name="请求结构" class="md-header-anchor"></a><span>请求结构 </span></h3><p><span>请求行、请求头部、请求数据。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">请求方法 请求地址 协议版本 </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">头1: 内容1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">头2: 内容2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">头n: 内容n</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">数据</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--------------------------------------------------------</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GET URL HTTP/1.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Host: ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...: ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">data</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 311px;"></div><div class="CodeMirror-gutters" style="display: none; height: 311px;"></div></div></div></pre><h3><a name="响应结构" class="md-header-anchor"></a><span>响应结构</span></h3><p><span>响应行、响应头、响应体</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">协议版本 转态码</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">头1: 内容1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">头2: 内容2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">头n: 内容n</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">数据</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">---------------------------------------------------------</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 200 OK</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">..: ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">..: ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">data</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 289px;"></div><div class="CodeMirror-gutters" style="display: none; height: 289px;"></div></div></div></pre><p>&nbsp;</p><h3><a name="请求响应步骤" class="md-header-anchor"></a><span>请求响应步骤</span></h3><ol start='' ><li><span>客户端Socket建立简介到web服务器。</span></li><li><span>客户端发送HTTP请求。</span></li><li><span>服务端接受请求返回HTTP响应。</span></li><li><span>释放TCP连接。[如果是HTTP1.0，客户端被动关闭。1.1则保持连接]</span></li><li><span>客户端解析HTML内容。</span></li></ol><p>&nbsp;</p><h3><a name="浏览器输入url后流程" class="md-header-anchor"></a><span>浏览器输入URL后，流程</span></h3><ol start='' ><li><span>DNS解析，获得目的IP地址</span></li><li><span>建立TCP连接</span></li><li><span>发送HTTP请求</span></li><li><span>服务器处理请求，返回数据</span></li><li><span>浏览器解析HTML</span></li><li><span>连接结束。</span></li></ol><p>&nbsp;</p><h3><a name="http状态码" class="md-header-anchor"></a><span>HTTP状态码</span></h3><p><strong><span>1xx</span></strong><span> 请求已接收，继续处理</span>
<strong><span>2xx</span></strong><span> 请求成功</span>
<strong><span>3xx</span></strong><span> 重定向</span>
<strong><span>4xx</span></strong><span> 客户端错误 请求语法错误或无法实现</span>
<strong><span>5xx</span></strong><span> 服务器错误</span></p><p>&nbsp;</p><h3><a name="get-post区别" class="md-header-anchor"></a><span>GET POST区别</span></h3><p><span>HTTP报文层面：</span>
<span>	</span><span>GET: 请求参数放在URL中</span>
<span>	</span><span>POST：请求参数放在报文数据块中</span></p><p><span>数据库层面：</span>
<span>	</span><span>GET：符合幂等性和安全性，此类请求通常用来查询操作。</span><span>	</span><span>【幂等</span><span>	</span><span>性：对数据库的一次操作或多次操作都不改变数据结果。】</span>
<span>	</span><span>POST：不符合，因为此类请求通常是用来修改数据的。</span></p><p><span>其他层面：</span>
<span>	</span><span>GET：可以被缓存、被存储。但POST不可以。</span></p><p>&nbsp;</p><h3><a name="http-和-https" class="md-header-anchor"></a><span>HTTP 和 HTTPS</span></h3><p><span>HTTPS会新增SSL层，安全版的安全协议。</span>
<span>SSL[Security Sockets Layer]安全套接层：</span></p><ol start='' ><li><span>安全协议</span></li><li><span>是操作系统对外的API。SSL3.0后改名TLS。</span></li><li><span>身份验证、数据加密保证数据安全性。</span></li></ol><p><img src="img/HTTPS.png" alt="image-20190921162826799" style="zoom:40%;" /></p><h4><a name="加密方式" class="md-header-anchor"></a><span>加密方式</span></h4><ol start='' ><li><span>对称加密 加密解密使用同一秘钥</span></li><li><span>非对称加密 加密解密使用不同秘钥。公钥、私钥。</span></li><li><span>哈希算法 MD5</span></li><li><span>数字签名 </span></li></ol><p>&nbsp;</p><h4><a name="https传输流程" class="md-header-anchor"></a><span>HTTPS传输流程</span></h4><ol start='' ><li><span>浏览器将支持的加密算法信息发给服务器。</span></li><li><span>服务器选择一个算法，以证书的形式回发给浏览器。</span></li><li><span>浏览器验证证书，结合证书里的公钥，用公钥加密客户生成的秘钥，发送给服务器。</span></li><li><span>服务器解密，获得客户秘钥，验证，返回用客户秘钥加密的响应信息。</span></li><li><span>浏览器用客户秘钥解密响应信息，验证，进行加密交互数据。</span></li></ol><p>&nbsp;</p><h4><a name="区别" class="md-header-anchor"></a><span>区别</span></h4><ol start='' ><li><span>HTTPS需要CA申请证书</span></li><li><span>HTTPS密文传输，HTTP明文传输</span></li><li><span>端口不一样，HTTPS 443   HTTP 80</span></li><li><span>HTTPS=HTTP+加密+认证+完整性保护</span></li></ol><p>&nbsp;</p><h1><a name="数据库" class="md-header-anchor"></a><span>数据库</span></h1><h2><a name="关系型数据库设计" class="md-header-anchor"></a><span>关系型数据库设计</span></h2><ol start='' ><li><p><span>程序</span></p><ol start='' ><li><span>存储管理</span></li><li><span>缓存机制</span></li><li><span>SQL解析</span></li><li><span>日志管理</span></li><li><span>权限划分</span></li><li><span>容灾机制</span></li><li><span>索引管理</span></li><li><span>锁管理</span></li></ol></li><li><p><span>存储[文件系统]</span></p></li></ol><p>&nbsp;</p><h2><a name="索引" class="md-header-anchor"></a><span>索引</span></h2><p><strong><span>索引数据结构:</span></strong></p><ol start='' ><li><span>二叉查找树</span></li><li><span>B-Tree 【B指代Balance】</span></li><li><span>B+-Tree</span></li><li><span>Hash结构</span></li><li><span>BitMap</span></li></ol><p>&nbsp;</p><h3><a name="b-tree" class="md-header-anchor"></a><span>B-Tree</span></h3><p><img src="img/Btree.png" alt="image-20190920173142947" style="zoom:40%;" /></p><p><strong><span>定义</span></strong><span> m阶树  上图为3阶树</span></p><ol start='' ><li><span>Root至少有两个孩子</span></li><li><span>每个节点最多有m个孩子</span></li><li><span>节点除root和leaf外，至少有ceil(m/2)个孩子</span></li><li><span>所有leaf位于同一层</span></li></ol><p><strong><span>设每个节点有n个关键字信息:</span></strong></p><ol start='' ><li><span>Ki(i=1,2..n)为关键字，且关键字按顺序升序排序</span></li><li><span>关键字个数n必须满足:[ceil(m/2)-1]&lt;=n&lt;=m-1，即比孩子个数[P指针的个数]少1。</span></li><li><span>Pi指向关键字范围(Ki-1,Ki)的子树</span></li></ol><p>&nbsp;</p><h3><a name="btree" class="md-header-anchor"></a><span>B+Tree</span></h3><p><img src="img/B+Tree.png" alt="image-20190920173301706" style="zoom:40%;" /></p><h3><a name="b树与b-树的区别" class="md-header-anchor"></a><span>B+树与B-树的区别</span></h3><ol start='' ><li><span>非叶子节点的子树指针[P1...Pn]个数与关键字[Ki...Kn]相同。</span></li><li><span>Pi指向的子树的数值范围为[Ki，Ki+1)，比如5下的P1指向的子树的数值范围为[5,10)。B-树是都是开区间(Ki,Ki+1)。</span></li><li><span>非叶子节点只用来索引，不存储数据，数据都存在叶子节点中。</span></li><li><span>所有叶子节点都有一个链指针指向下一个叶子节点。更有利于数据库扫描。</span></li></ol><p>&nbsp;</p><h3><a name="hash索引" class="md-header-anchor"></a><span>Hash索引</span></h3><p><strong><span>缺点</span></strong></p><ol start='' ><li><span>只能满足&quot;=&quot;，&quot;in&quot;语句，不能使用范围查询语句。</span></li><li><span>无法避免数据的排序操作。</span></li><li><span>当索引是组合索引时候，不能使用其中一个字段做hash索引，只能用组合索引整体做索引，计算hash值。但B+树支持使用组合索引中的部分字段做索引。</span></li><li><span>不能避免表扫描。</span></li><li><span>性能不稳定。大量hash值相等的数据，性能比B+树低。</span></li></ol><p>&nbsp;</p><h3><a name="索引分类" class="md-header-anchor"></a><span>索引分类</span></h3><h4><a name="innodb索引" class="md-header-anchor"></a><span>InnoDB索引</span></h4><ol start='' ><li><span>普通索引</span></li><li><span>主键索引</span></li><li><span>唯一索引</span></li></ol><p>&nbsp;</p><h4><a name="密集索引和稀疏索引" class="md-header-anchor"></a><span>密集索引和稀疏索引</span></h4><p><img src="img/密集稀疏索引.png" alt="image-20190921162222834" style="zoom:40%;" /></p><p><strong><span>密集索引</span></strong><span>: 每一个数据记录都有对应的索引项</span></p><p><strong><span>稀疏索引</span></strong><span>: 部分数据记录有索引项</span></p><p>&nbsp;</p><p><strong><span>?MyISAM</span></strong><span>: 所有索引都是稀疏索引。</span></p><p><strong><span>InnoDB</span></strong><span>: 主键索引作为密集索引。</span></p><ol start='' ><li><span>若果有主键被定义，该主键索引作为密集索引</span></li><li><span>没有定义主键，该表的唯一非空字段索引作为密集索引</span></li><li><span>不满足上述条件，内部生成一个隐藏的主键，此主键索引作密集索引</span></li></ol><p>&nbsp;</p><h4><a name="聚簇索引和非聚簇索引-不是一种单独的索引类型而是根据存储方式划分的种类" class="md-header-anchor"></a><span>聚簇索引和非聚簇索引 [不是一种单独的索引类型，而是根据存储方式划分的种类]</span></h4><p><strong><span>聚簇索引</span></strong><span> 数据行存放在索引的叶子节点下。一个表只有一个聚簇索引。</span>
<strong><span>非聚簇索引</span></strong><span> 数据行和索引分开存放。</span></p><p><img src="img/聚簇非聚簇索引.png" alt="image-20190921162049888" style="zoom:50%;" /></p><p><strong><span>MyISAM</span></strong><span>:</span>
<span>使用非聚簇索引，把数据和索引分开存储。</span></p><p><strong><span>InnoDB</span></strong><span>:</span>
<strong><span>主键索引</span></strong><span>是聚簇索引[也是密集索引]。其他索引都是非聚簇索引【有称不能叫非聚簇索引，说这个词是针对MyISAM的】，又称作</span><strong><span>二级索引/辅助索引</span></strong><span>，因为用这些索引要查询两次才能定位到数据，它们的叶子节点都存放的是主键值，通过这个主键值到之间索引处进行二次查询。</span></p><p>&nbsp;</p><h3><a name="优化慢查询" class="md-header-anchor"></a><span>优化慢查询</span></h3><ol start='' ><li><span>用日志定位慢查询sql</span></li><li><span>用explain分析查询sql</span></li><li><span>修改sql或者让sql尽量走索引</span></li></ol><p>&nbsp;</p><h3><a name="联合索引的最左匹配原则" class="md-header-anchor"></a><span>联合索引的最左匹配原则</span></h3><p><strong><span>联合索引</span></strong><span>: 由多列组成的索引。内部数据是按照建索引时字段(a1,a2...,an)顺序给数据排序。</span></p><p><span>设联合索引有N个字段(a1,a2...,an)，where语句有多个条件语句(s1,s2...)。MySQL从联合索引</span><strong><span>从最左边字段a1开始向右匹配</span></strong><span>，如果</span><strong><span>where语句不包含这字段</span></strong><span>或</span><strong><span>此语句是范围语句</span></strong><span>[&lt;,&gt;,between,部分like(like以%开头不用索引，以明确字符开头使用索引)]，则停止匹配，该字段以前的字段都可以用索引。</span></p><p>&nbsp;</p><h2><a name="锁" class="md-header-anchor"></a><span>锁</span></h2><h3><a name="种类" class="md-header-anchor"></a><span>种类</span></h3><p><strong><span>按锁级别划分</span></strong><span> 读锁/共享锁、写锁/排它锁</span></p><p><span>一个资源可以同时存在多个</span><strong><span>读锁/共享锁</span></strong><span>。当存在1个</span><strong><span>写锁/排它锁</span></strong><span>时，不能有任何锁，直到这个锁释放。一个</span><strong><span>写锁/排它锁</span></strong><span>只能等资源没有任何锁的情况下，占有这个资源。</span></p><figure><table><thead><tr><th>&nbsp;</th><th><span>写锁/排它锁</span></th><th><span>读锁/共享锁</span></th></tr></thead><tbody><tr><td><strong><span>写锁/排它锁</span></strong></td><td><span>冲突</span></td><td><span>冲突</span></td></tr><tr><td><strong><span>读锁/共享锁</span></strong></td><td><span>冲突</span></td><td><font color="red"><span>兼容</span></font></td></tr></tbody></table></figure><p><strong><span>按锁的粒度</span></strong><span> 行级锁、表级锁、页级锁</span></p><p><strong><span>按加锁方式</span></strong><span> 自动锁、显示锁</span></p><p><strong><span>按操作方式</span></strong><span> DML锁、DDL锁</span></p><p><strong><span>按使用方式</span></strong><span> 乐观锁、悲观锁</span></p><p>&nbsp;</p><h3><a name="表级锁-行级锁" class="md-header-anchor"></a><span>表级锁 行级锁</span></h3><p><span>MyISAM用的是表级锁，不支持行级锁。</span>
<span>InnodDB支持行级锁[索引查询]，也支持表级锁[非索引查询]。根据情况选用不同的锁。</span></p><figure><table><thead><tr><th>&nbsp;</th><th><span>行级锁</span></th><th><span>表级锁</span></th></tr></thead><tbody><tr><td><span>MyISAM</span></td><td><span>不支持</span></td><td><span>支持</span></td></tr><tr><td><span>InnoDB</span></td><td><span>支持[操作加锁并且</span><strong><span>走索引</span></strong><span>是行级锁]</span></td><td><span>支持[操作加锁并且</span><strong><span>不走索引</span></strong><span>是表级锁]</span></td></tr></tbody></table></figure><p><span>InnoDB中，普通的select是不加任何锁的。</span>
<strong><span>读锁/共享锁</span></strong><span>，select末尾加上</span><strong><span>lock in share mode</span></strong><span>。</span>
<strong><span>写锁/排他锁</span></strong><span>，seledt末尾加上</span><strong><span>for update</span></strong><span>。</span></p><p>&nbsp;</p><h3><a name="acid事务四大特性" class="md-header-anchor"></a><span>ACID事务四大特性</span></h3><p><span>A 原子性: 事务里的所有操作是一个工作单元，要不全部发生，要不全部回滚。</span></p><p><span>C一致性: 事务开始前后，数据库的完整性和业务逻辑上的一致性不被破坏。</span></p><p><span>I隔离性: 事务之间即时操作相同的数据也互不影响。</span></p><p><span>D持久性: 事务提交后，数据更变后应该永久保存，不会被回滚。</span></p><p>&nbsp;</p><h3><a name="不同的隔离级别和问题" class="md-header-anchor"></a><span>不同的隔离级别和问题</span></h3><figure><table><thead><tr><th><span>隔离级别</span></th><th><span>脏读</span></th><th><span>不可重复读</span></th><th><span>幻读</span></th></tr></thead><tbody><tr><td><span>READ UNCOMMITTED</span></td><td><span>Y</span></td><td><span>Y</span></td><td><span>Y</span></td></tr><tr><td><span>READ COMMITTED</span></td><td><span>N</span></td><td><span>Y</span></td><td><span>Y</span></td></tr><tr><td><span>REPEATABLE READ</span></td><td><span>N</span></td><td><span>N</span></td><td><span>Y</span></td></tr><tr><td><span>SERIALIZABLE</span></td><td><span>N</span></td><td><span>N</span></td><td><span>N</span></td></tr></tbody></table></figure><p>&nbsp;</p><h3><a name="innodb-默认事务隔离级别rr如何避免幻读" class="md-header-anchor"></a><span>InnoDB 默认事务隔离级别RR如何避免幻读</span></h3><p><strong><span>幻读</span></strong><span>: 事务A不同时间同样的sql，返回结果不同，因为事务B在期间对数据操作并且提交。例如select count(1) from student;，返回不同的结果。</span></p><h4><a name="使用快照读-一定程度避免幻读" class="md-header-anchor"></a><span>使用快照读 一定程度避免幻读</span></h4><p><strong><span>快照读</span></strong><span> [不加锁的数据读取]</span></p><ol start='' ><li><span>读取的是数据快照，数据被修改，快照无法察觉，所以不会产生幻读。</span></li><li><strong><span>不加锁的非阻塞select</span></strong><span>是快照读。普通的select[RR级别下，不加锁]读取到的是快照，事务中直到第一次调用此select时，才会对数据进行快照。</span></li></ol><p>&nbsp;</p><h5><a name="快照怎么实现-mvcc" class="md-header-anchor"></a><span>快照怎么实现? MVCC</span></h5><p><strong><span>undo日志</span></strong>
<span>事务提交</span><strong><span>update/delete/insert</span></strong><span>的时候，相关的数据行记录到</span><strong><span>undo日志</span></strong><span>里，日志里保存了修改前旧版本数据的内容。当操作相关数据行的所有事务提交后，这些记录会被删除。</span></p><p><img src="img/undo日志.png" alt="image-20190924162528821" style="zoom:50%;" /></p><p>&nbsp;</p><p><strong><span>快照读过程</span></strong>
<span>快照读的时候，在undo日志中，找小于等于当前事务版本号的记录。版本号其实是上图的</span><strong><span>DB_TRX_ID</span></strong><span>[事务ID，后发生的事务ID比较大]</span></p><p>&nbsp;</p><h4><a name="使用next-key锁-避免当前读产生的幻读" class="md-header-anchor"></a><span>使用next-key锁 避免当前读产生的幻读</span></h4><p><strong><span>当前读</span></strong><span>[加锁的数据操作]</span></p><ol start='' ><li><p><span>读取数据的最新版本，</span><strong><span>所以当有其他事务提交时，会产生幻读。</span></strong></p></li><li><p><span>以下都是使用当前读，即加锁的数据操作</span></p><ol start='' ><li><span>加锁的select。select ... lock in share mode / for update</span></li><li><span>update/delete/insert</span></li></ol></li></ol><p><span>InnoDB为了避免</span><strong><span>当前读</span></strong><span>时产生幻读，会使用</span><strong><span>next-key锁</span></strong><span>，对读取的数据进行加锁，不得被修改。</span></p><p><strong><span>next-key锁</span></strong><span> 行锁+Gap锁[间隙锁]</span></p><p>&nbsp;</p><h5><a name="gap锁" class="md-header-anchor"></a><span>Gap锁 </span></h5><p><span>设被上Gap锁的区间为A区间，阻塞情况有</span>
<span>	</span><span>insert  在A区间内的记录会阻塞。</span>
<span>	</span><span>update 把A区间外的索引，update成A区间内都会被阻塞。</span></p><p><strong><span>在使用</span><em><span>当前读</span></em><span>的情况下</span></strong><span>:</span></p><ul><li><p><span>使用</span><strong><span>主键索引</span></strong><span>或者</span><strong><span>唯一键索引</span></strong></p><ul><li><span>where</span><strong><span>命中的条件</span></strong><span>，只有行锁，没有Gap锁。</span></li><li><span>where</span><strong><span>没命中的条件</span></strong><span>，会用为没命中的索引上Gap锁。</span><strong><span>索引按照(主键/唯一索引)规则排序</span></strong><span>，区间为距离这索引最近的左右两个索引值(l,r)。</span></li></ul></li><li><p><span>使用</span><strong><span>普通索引</span></strong></p><ul><li><span>无论条件是否命中，都使用Gap锁。</span></li><li><strong><span>索引按照(普通索引，主键索引)规则排序</span></strong><span>，</span><strong><span>无论where条件是否命中</span></strong><span>，都会加Gap锁。区间为距离这索引最近的左右两个索引值</span><strong><span>(l,r)</span></strong><span>，而且对普通索引命中的记录主键要上行锁。</span></li></ul></li></ul><p><img src="img/普通索引Gap锁.png" alt="image-2019092419531761" style="zoom:50%;" /></p><ul><li><p><strong><span>不使用索引</span></strong></p><ul><li><span>会锁住所有gap，而且会使用表锁。事务提交前，其他事务的</span><strong><span>当前读</span></strong><span>会阻塞。</span></li></ul></li></ul><p>&nbsp;</p><h2><a name="范式" class="md-header-anchor"></a><span>范式</span></h2><h3><a name="第一范式" class="md-header-anchor"></a><span>第一范式</span></h3><p><span>数据库表中的所有字段值都是不可分割的原子值</span></p><h3><a name="第二范式" class="md-header-anchor"></a><span>第二范式</span></h3><p><span>满足第一范式,</span><strong><span>表中的字段必须完全依赖于全部主键而非部分主键。</span></strong></p><h3><a name="第三范式" class="md-header-anchor"></a><span>第三范式</span></h3><p><span>满足第二范式，</span><strong><span>非主键字段必须互不依赖。</span></strong></p><p>&nbsp;</p><h2><a name="分表-分区-分库" class="md-header-anchor"></a><span>分表 分区 分库</span></h2><h3><a name="分表-分区" class="md-header-anchor"></a><span>分表 分区</span></h3><p><strong><span>分表</span></strong><span>是把一个表分成实体存在的多个表。分表后，</span><strong><span>单表的并发能力提高了，磁盘I/O性能也提高了</span></strong><span>。重点</span><strong><span>是存取数据时，提高mysql并发能力上。</span></strong></p><p><strong><span>分区</span></strong><span>还是只有一个表，只是这个表的数据被分成不同的区块存储。重点</span><strong><span>突破磁盘的读写能力</span></strong><span>，从而达到提高mysql性能的目的。</span></p><p>&nbsp;</p><h1><a name="jvm" class="md-header-anchor"></a><span>JVM</span></h1><h2><a name="面试题" class="md-header-anchor"></a><span>面试题 </span></h2><h3><a name="对java的理解" class="md-header-anchor"></a><span>对java的理解</span></h3><p><strong><span>平台无关性</span></strong>
<strong><span>GC</span></strong>
<strong><span>语言特性</span></strong>
<strong><span>面向对象</span></strong>
<strong><span>类库</span></strong>
<strong><span>异常处理</span></strong></p><p>&nbsp;</p><h4><a name="平台无关性" class="md-header-anchor"></a><span>平台无关性</span></h4><p><span>一次编译，到处运行。源码被编译成字节码文件，不同平台的JVM加载字节码文件，最终解释成机器码运行，不用重新编译。[javap是jdk自带的反编译工具，可用来反编译字节码]</span></p><p>&nbsp;</p><h3><a name="什么是反射" class="md-header-anchor"></a><span>什么是反射</span></h3><p><span>Java反射是指运行时，对于类，可以知道它的所有方法和属性；对于对象，可以调用它的所有方法和属性。这种动态获取信息和动态调用的功能称为反射。</span></p><p>&nbsp;</p><h2><a name="jvm结构" class="md-header-anchor"></a><span>JVM结构 </span></h2><p><img src="img/JVM结构.png" alt="image-2019092516564775" style="zoom:50%;" /></p><p><span>主要4大部分:</span></p><ol start='' ><li><span>Class Loader[类加载器] 加载class文件到内存</span></li><li><span>Runtime Data Area[运行时数据区] JVM内存结构模型</span></li><li><span>Execution Engine[执行引擎] 对命令进行解析</span></li><li><span>Native Interface[本地库接口] 融合不同的开发语言的原生库为Java所用</span></li></ol><p>&nbsp;</p><h3><a name="jvm内存模型" class="md-header-anchor"></a><span>JVM内存模型</span></h3><p><img src="img/jvm内存模型.png" alt="image-20190926211125473" style="zoom:40%;" /></p><h4><a name="程序计数器-pc-register" class="md-header-anchor"></a><span>程序计数器 PC Register</span></h4><ol start='' ><li><span>线程私有</span></li><li><span>当前线程执行的字节码</span><strong><span>行号指示器</span></strong></li><li><span>改变计数器的值来选取下一条要执行的字节码指令。</span></li><li><span>正在执行java方法，值为字节码指令的地址。native方法，则为空值Undefined。</span></li><li><span>唯一一个在JVM规范中</span><strong><span>没有规定OutOfMemoryError情况</span></strong><span>的区域。</span></li></ol><p>&nbsp;</p><h4><a name="虚拟机栈-jvm-stack" class="md-header-anchor"></a><span>虚拟机栈 JVM Stack</span></h4><ol start='' ><li><p><span>线程私有，生命周期与线程相同。</span></p></li><li><p><span>自动释放内存。</span></p></li><li><p><span>保存java方法执行的数据结构</span><strong><span>栈帧</span></strong><span>。</span></p></li><li><p><span>JVM规范定义了两种异常</span></p><ol start='' ><li><strong><span>StackOverflowError</span></strong><span> 栈深度大于虚拟机的允许(即方法嵌套过多，比如递归深度过深)。</span></li><li><strong><span>OutOfMemoryError</span></strong><span> 栈的内存过大，扩展内存时，无法申请到足够大的内存。比如创建N个线程。</span></li></ol></li></ol><p>&nbsp;</p><h5><a name="栈帧" class="md-header-anchor"></a><span>栈帧</span></h5><p><span>每个方法在执行的同时会产生一个叫栈帧的数据结构。方法</span><strong><span>调用到执行完成</span></strong><span>，对应着栈帧在虚拟机栈中的</span><strong><span>入栈到出栈</span></strong><span>。</span>
<span>数据结构包含以下信息:</span></p><ol start='' ><li><span>局部变量表 保存编译器可知的基本数据类型和对象引用</span></li><li><span>操作数栈 </span></li><li><span>动态链接</span></li><li><span>方法出口</span></li><li><span>...</span></li></ol><p>&nbsp;</p><h4><a name="本地方法栈-native-method-stack" class="md-header-anchor"></a><span>本地方法栈 Native Method Stack</span></h4><ol start='' ><li><span>本地方法栈与虚拟机栈相似，只不过本地方法栈是为native方法服务。</span></li><li><span>JVM规范没有强制规范其实现方式、数据结构，虚拟机可以自由实现。</span></li><li><span>有的虚拟机把虚拟机栈和本地方法栈合并。</span></li><li><span>与虚拟机栈一样会有</span><strong><span>StackOverflowError</span></strong><span> 和 </span><strong><span>OutOfMemoryError</span></strong><span>。</span></li></ol><p>&nbsp;</p><h4><a name="堆-heap" class="md-header-anchor"></a><span>堆 Heap</span></h4><ol start='' ><li><span>线程共享。所有线程共享这块区域。</span></li><li><span>虚拟机启动时创建，用于存放对象实例。</span></li><li><span>物理上不连续但逻辑上连续的存储空间。</span></li><li><span>GC垃圾收集的主要管理区域。</span></li><li><strong><span>OutOfMemoryError</span></strong><span> 产生过多没有对象实例，而且未被GC回收。</span></li></ol><p>&nbsp;</p><h5><a name="新生代和老年代" class="md-header-anchor"></a><span>新生代和老年代</span></h5><p><strong><span>JDK1.7 1.8</span></strong><span> 中，HotSpot将</span><strong><span>堆</span></strong><span>划分为</span><strong><span>新生代</span></strong><span>和</span><strong><span>老年代</span></strong><span>。</span>
<strong><span>新生代</span></strong><span>又划分为: 一个</span><strong><span>Eden</span></strong><span>、两个</span><strong><span>Survivor</span></strong><span>空间。比例是</span><strong><span>8:1:1</span></strong><span>。</span></p><p>&nbsp;</p><h5><a name="堆栈大小参数调优" class="md-header-anchor"></a><span>堆栈大小参数调优</span></h5><p><span>-Xss 规定每个线程虚拟机栈/堆的大小</span></p><p><span>-Xms 堆的初始大小</span></p><p><span>-Xmx 堆能达到的最大值</span></p><p><span>-Xmn 设置新生代大小</span></p><p><span>一般设置 -Xms 和 -Xmx 一样大小，因为内存扩大会影响程序运行。</span></p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="方法区-method-area" class="md-header-anchor"></a><span>方法区 Method Area</span></h4><ol start='' ><li><span>线程共享。</span></li><li><span>JVM规范中，方法区在虚拟机启动的时候创建，虽然方法区是堆的逻辑组成部分，但是简单的虚拟机实现可以选择不在方法区实现垃圾回收与压缩。</span></li><li><span>存储被虚拟机加载的类信息、常量[常量池 Runtime Constant Pool，后来被移动到堆中]、静态变量等数据。</span></li><li><strong><span>OutOfMemoryError</span></strong><span> 无法满足内存分配需求。[程序运行时，动态加载过多的类]</span></li></ol><p>&nbsp;</p><h5><a name="方法区的一种实现-永久代permgen-space" class="md-header-anchor"></a><span>方法区的一种实现 永久代PermGen Space</span></h5><p><span>方法区[Method Area]是JVM的一种规范，而永久代是Hotspot虚拟机对这种规范的一种实现。</span>
<strong><span>JDK1.7</span></strong><span>时，永久代中的</span><strong><span>常量池</span></strong><span>被移除到</span><strong><span>堆Heap</span></strong><span>中。</span>
<strong><span>JDK1.8</span></strong><span>时，用</span><strong><span>元空间</span></strong><span>代替</span><strong><span>永久代</span></strong><span>。</span></p><p>&nbsp;</p><h5><a name="永久代permgen和元空间metaspacehttpswwwcnblogscompaddixp5309550html" class="md-header-anchor"></a><a href='https://www.cnblogs.com/paddix/p/5309550.html'><span>永久代(PermGen)和元空间(Metaspace)</span></a></h5><p><span>HotSpot虚拟机在1.8之后已经取消了永久代，改为元空间，类的元信息被存储在元空间中。元空间没有使用堆内存，而是与堆不相连的本地内存区域。</span></p><p>&nbsp;</p><h5><a name="常量池" class="md-header-anchor"></a><span>常量池</span></h5><p><span>原本在永久代中，但后来被放到堆中，可以避免一些OutOfMemoryError，常量池大小不受永久代大小约束。</span></p><p>&nbsp;</p><h5><a name="string-intern-在不同jdk版本的区别" class="md-header-anchor"></a><span>String intern 在不同JDK版本的区别</span></h5><p><span>如果常量池中，存在次字符串，则这个字符串; 如果常量池中不存在:</span>
<span>	</span><span>JDK1.6: 将创建此字符串的副本放入常量池，但是副本是个新对象，引用地址不相同。</span>
<span>	</span><span>JDK1.6后: 将次字符串的引用放到常量池，而不是创建一个新的副本。</span></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h2><a name="jvm如何加载class文件" class="md-header-anchor"></a><span>JVM如何加载class文件? </span></h2><h3><a name="类的加载过程" class="md-header-anchor"></a><span>类的加载过程</span></h3><ol start='' ><li><strong><span>加载阶段</span></strong><span> ClassLoader加载字节码进内存，生成java.lang.Class对象放在方法区中[Method Area]</span></li><li><strong><span>连接阶段</span></strong><span> 此阶段部分内容与加载交叉进行，例如验证字节码</span>
<span>2.1 </span><strong><span>验证</span></strong><span> 检查字节码是否符合规范，不会危害JVM。</span>
<span>2.2 </span><strong><span>准备</span></strong><span> 为</span><strong><span>类变量</span></strong><span>分配内存和设置</span><strong><span>零值</span></strong><span>[而不是初始化的值]，而初始化值是在初始化阶段进行。但如果类变量的值是常量[修饰符static final]，那么会直接设置初始化值。</span>
<span> 2.3 </span><strong><span>解析</span></strong><span> 将常量池内的符号引用转为直接引用。</span></li><li><strong><span>初始化阶段</span></strong><span> 执行类构造器</span><clinit><span>()[所有类变量的赋值动作+static代码块]</span></li></ol><p>&nbsp;</p><h3><a name="类加载器classloader" class="md-header-anchor"></a><span>类加载器ClassLoader</span></h3><p><strong><span>作用</span></strong><span>: 在类加载过程中的加载阶段，负责将字节码文件加载进内存，所有Class都由ClassLoader加载进内存。</span></p><p>&nbsp;</p><h4><a name="类加载器种类" class="md-header-anchor"></a><span>类加载器种类</span></h4><ol start='' ><li><span>BootStrapClassLoader C++编写，加载核心库java.*</span></li><li><span>ExtClassLoader Java编写，加载扩展库javax.*</span></li><li><span>AppClassLoader Java编写，加载程序所在目录/classpath的类</span></li><li><span>自定义ClassLoader </span></li></ol><p>&nbsp;</p><h4><a name="双亲委派模型-parents-delegation-model" class="md-header-anchor"></a><span>双亲委派模型 [Parents Delegation Model]</span></h4><p><span>除了顶层类加载器，其它加载器都有父类加载器。他们之间并没有java继承关系，是逻辑上的父类</span></p><p><img src="img/双亲委派模型1.png" alt="image-20190925191243346" style="zoom:35%;" /></p><p><img src="img/双亲委派模型2.png" alt="image-20190925234617052" style="zoom:44%;" /></p><p><strong><span>ClassLoader加载类的过程</span></strong>
<span>当一个类加载器接受到类加载的请求</span></p><ol start='' ><li><p><span>从当前加载器开始查询是否已将加载过此类，</span></p><ol start='' ><li><span>有，则返回</span></li><li><span>没有，则委托父类加载器</span></li></ol></li><li><p><span>如果最终到顶层启动类加载器也没有加载过此类。那么会从顶层开始尝试加载目标类。</span></p><ol start='' ><li><span>加载成功，则返回。</span></li><li><span>加载失败，就是当前加载器加载不到目标类，那么会向下层委托加载目标类。</span></li><li><span>没有加载器能加载到目标类，则抛出ClassNotFoundException异常。</span></li></ol></li></ol><p><strong><span>为什么使用双亲委派模型加载类?</span></strong>
<span>避免字节码被多次重复加载。</span></p><p>&nbsp;</p><h4><a name="classloader对象loadclass-和-classforname-区别" class="md-header-anchor"></a><span>ClassLoader对象loadClass 和 Class.forName 区别</span></h4><p><span>loadClass: 加载类并没有到连接阶段，不会执行static代码块。</span>
<span>forName: 加载类完成了初始化阶段，会执行static代码块。</span></p><p><span>在Spring中使用loadClass作为延迟加载，加快启动速度。类的初始化工作留到实际使用到这个类的时候再做。</span></p><p>&nbsp;</p><h1><a name="gc" class="md-header-anchor"></a><span>GC</span></h1><h2><a name="引用类型" class="md-header-anchor"></a><span>引用类型</span></h2><figure><table><thead><tr><th><span>引用类型</span></th><th><span>被GC回收情况</span></th><th><span>用途</span></th><th><span>生存时间</span></th></tr></thead><tbody><tr><td><span>强引用</span></td><td><span>从来不会</span></td><td><span>对象一般状态</span></td><td><span>JVM停止运行时终止</span></td></tr><tr><td><span>软引用</span></td><td><span>内存不足时</span></td><td><span>缓存</span></td><td><span>内存不足时终止</span></td></tr><tr><td><span>弱引用</span></td><td><span>发生GC时</span></td><td><span>缓存</span></td><td><span>发生GC后终止</span></td></tr><tr><td><span>虚引用</span></td><td><span>-</span></td><td><span>标记、哨兵</span></td><td><span>-</span></td></tr></tbody></table></figure><p>&nbsp;</p><h2><a name="判断对象生存还是死亡" class="md-header-anchor"></a><span>判断对象生存还是死亡</span></h2><h3><a name="引用计数算法" class="md-header-anchor"></a><span>引用计数算法</span></h3><p><strong><span>实现</span></strong><span>: 给对象添加一个引用计数器，每当有一个地方引用就+1，引用失效-1。当这个值为0时，意味对象死亡。</span></p><p><strong><span>优点</span></strong><span>: 实现简单，效率快。</span>
<strong><span>缺点</span></strong><span>: 无法解决循环引用问题，会导致内存泄露。</span></p><p>&nbsp;</p><h3><a name="可达性分析算法java使用此算法" class="md-header-anchor"></a><span>可达性分析算法[Java使用此算法]</span></h3><p><span>实现: 把</span><strong><span>GC Roots</span></strong><span>作为起点，对象作为终点，检查对象是否可达，如果能找到一条路径[引用链]到一个对象，那么这个对象存活，否则死亡。</span></p><p><strong><span>可作为GC Roots的对象</span></strong></p><ol start='' ><li><span>虚拟机栈[栈帧中的本地变量]中引用的对象。</span></li><li><span>方法区中类静态属性引用的对象。</span></li><li><span>方法区中常量引用的对象。</span></li><li><span>本地方法栈中JNI[Java Native Interface，即Native方法]引用的对象。</span></li></ol><p>&nbsp;</p><h3><a name="被回收的对象" class="md-header-anchor"></a><span>被回收的对象</span></h3><p><span>GC会回收真正死亡的对象。真的死亡指</span><strong><span>对象不可达，并且无法通过finalize方法成为可达的对象。</span></strong></p><p><span>一个对象要被回收需要两次标记，第一次标记证明对象不可达，第二次证明对象执行finalize后也不可达。</span>
<span>第一次: JVM中，不可达的对象被标记。</span>
<span>第二次: 没必要执行finalize的对象[</span><strong><span>没覆盖finalize方法</span></strong><span>或者</span><strong><span>JVM曾调用过一次</span></strong><span>]；有必要执行，但执行后，对象还是不可达的对象。</span></p><h4><a name="finalize方法" class="md-header-anchor"></a><span>finalize方法</span></h4><p><span>特点:</span></p><ol start='' ><li><span>只运行一次</span></li><li><span>不保证能运行到结束。</span></li></ol><p><span>当一个对象有必要执行finalize方法，此对象会被放入F-Queue队列中，随后JVM用Finalizer线程去执行finalize方法。</span></p><p>&nbsp;</p><p>&nbsp;</p><h2><a name="垃圾回收算法" class="md-header-anchor"></a><span>垃圾回收算法</span></h2><h3><a name="标记-清除算法-mark-and-sweep" class="md-header-anchor"></a><span>标记-清除算法 Mark and Sweep</span></h3><p><span>它是最基础的算法，后续算法都是根据此算法不足进行改进得到的。</span></p><p><strong><span>实现</span></strong><span>: </span></p><ol start='' ><li><strong><span>标记</span></strong><span> 标记需要被回收的对象。</span></li><li><strong><span>清除</span></strong><span> 标记完成后统一回收被标记的对象。</span></li></ol><p><strong><span>缺点</span></strong><span>:</span></p><ol start='' ><li><span>效率不高。标记和清除效率不高。</span></li><li><span>空间碎片化。回收后空间不连续，影响大对象的空间分配，当没有足够大的内存分配给大对象时，会体检触发另一次垃圾回收。</span></li></ol><p>&nbsp;</p><h3><a name="复制算法-copying" class="md-header-anchor"></a><span>复制算法 Copying</span></h3><p><span>这个算法解决</span><strong><span>标记-清除算法</span></strong><span>的两个问题，效率低和空间碎片化。</span><strong><span>一般适合新生代。</span></strong></p><p><strong><span>实现</span></strong><span>: 将一块内存分为大小相同的两块，只使用其中一块。当一块用完，就将存活对象复制到另外一块空闲内存中[此块内存是按顺序填充，不会出现碎片化内存]，然后清理已使用的内存块。</span></p><p><strong><span>优点</span></strong><span>: 效率高。空间连续。</span></p><p><strong><span>缺点</span></strong><span>: 会浪费部分空间，所以只适合对象存活率低的场景。</span></p><p><span>JDK1.7 1.8，HotSpot默认对新生代区域使用此种算法。Eden区只会向外复制，不会有对象复制进Eden，新创建对象放在Eden区，两个Survivor作为相互复制的两块内存，同一时间只有Eden区加1个Survivor区作为存储空间，只有1个Survivor区的空间(10%)被浪费，当发生垃圾回收时，Eden区和一个Survivor区的对象复制到另一个Survivor区。</span></p><p><strong><span>堆内空间分配：</span></strong><span>Eden + Survivor + Survivor [8:1:1]</span></p><p><img src="img/堆内分区.png" alt="image-20190929142042035" style="zoom:18%;" /></p><p>&nbsp;</p><h3><a name="标记-整理-mark-compact" class="md-header-anchor"></a><span>标记-整理 Mark-Compact</span></h3><p><span>这个算法适合</span><strong><span>对象存活率高</span></strong><span>的场景，而且没有碎片化空间。</span><strong><span>一般适合老年代。</span></strong></p><p><strong><span>实现</span></strong><span>: 与</span><strong><span>标记-清理</span></strong><span>算法相似。但第二步，不是清理，而是整理。整理是把存活对象向前移动覆盖掉被回收的对象，使内存空间连续，末端内存全部回收。</span></p><p><img src="img/标记-整理算法.png" alt="image-20190929234036473" style="zoom:40%;" /></p><p>&nbsp;</p><h3><a name="分代收集算法-generational-collector" class="md-header-anchor"></a><span>分代收集算法 Generational Collector</span></h3><p><span>根据对象的不同的生命周期划分区域，对不同区域使用不同的回收算法。</span>
<strong><span>新生代[Young Generation]对象存活率低</span></strong><span>: 使用</span><strong><span>复制算法</span></strong><span>。每次回收有大批对象死去，不需要太多空间，使用</span><strong><span>标记-清理/整理</span></strong><span>效率慢。</span>
<strong><span>老年代[Old Generation]对象存活率高</span></strong><span>: 使用</span><strong><span>标记-清理/整理</span></strong><span>。每次回收有大批对象存活，需要大量空间，使用复制算法可能会空间不足。</span></p><figure><table><thead><tr><th style='text-align:left;' ><span>JDK1.6  JDK1.7 栈分区+老年代</span></th><th><span>JDK1.8 栈分区[老年代被移除]</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><img src="img/jdk67堆分区.png" alt="image-20190929141723850" style="zoom:27%;" /></td><td><img src="img/jdk8堆分区.png" alt="image-20190929141737505" style="zoom:28%;" /></td></tr></tbody></table></figure><p>&nbsp;</p><h4><a name="minor-gc-和-major-gc-full-gc" class="md-header-anchor"></a><span>Minor GC 和 Major GC/ Full GC</span></h4><p><strong><span>Minor GC</span></strong><span>: 发生在新生代的垃圾回收。频繁，速度较快。</span>
<strong><span>Major GC/ Full GC</span></strong><span>: 发生在老年代的垃圾回收。不频繁，速度一般比Minor GC慢10倍以上。 </span></p><p><strong><span>Major GC/ Full GC触发条件</span></strong><span>:</span></p><ol start='' ><li><span>老年代空间不足</span></li><li><span>永久代空间不足</span></li><li><span>Minor GC后产生晋升老年代的对象，在老年代没有足够空间存放。</span></li><li><span>调用System.gc()</span></li></ol><p>&nbsp;</p><h2><a name="对象分配策略" class="md-header-anchor"></a><span>对象分配策略</span></h2><h3><a name="新生对象分配到新生代的eden区" class="md-header-anchor"></a><span>新生对象分配到新生代的Eden区</span></h3><ul><li><p><span>Eden有足够空间，新对象会被分配到Eden区。</span></p></li><li><p><span>Eden空间不够，触发Minor GC后，</span></p><ul><li><span>空间足够，将新对象放到Eden区。</span></li><li><span>空间依然不足，新对象将会放到老年代区域。</span></li></ul></li></ul><p>&nbsp;</p><h3><a name="对象从新生代晋升到老年代" class="md-header-anchor"></a><span>对象从新生代晋升到老年代</span></h3><ol start='' ><li><span>长期存活的对象。经历一定次数Minor GC，依旧存活的对象。[</span><strong><span>-XX:MaxTenuringThreshold</span></strong><span> 设置次数，超过这个次数放入老年代]</span></li><li><span>GC后，新生代空间依然不足以放下的对象。当Eden装不下一个对象时，先触发Minor GC后，Eden区或Survivor区依旧放不下的对象。</span></li><li><span>新生成的大对象。[</span><strong><span>-XX:PretenuerSizeThreshold</span></strong><span> 设置大对象大小，超过这个大小直接放入老年代]</span></li></ol><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h2><a name="垃圾回收器garbage-collectors--垃圾回收算法的实现" class="md-header-anchor"></a><span>垃圾回收器Garbage Collectors  [垃圾回收算法的实现]</span></h2><h3><a name="stop-the-world-stw" class="md-header-anchor"></a><span>Stop-the-world [STW]</span></h3><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GC发生时必须停顿所有线程，为了保证可达性分析的准确性，不停顿那么对象可达性会有不断变化。</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p>&nbsp;</p><h3><a name="oopmapordinary-object-pointer-map" class="md-header-anchor"></a><span>OopMap[Ordinary Object Pointer Map]</span></h3><p><span>通过OopMap，JVM可以得知对象引用存放的位置[可作为GC Roots的对象]，不用去不同的内存区中扫描找出对象引用，这可以协助GC Roots的枚举快速完成，以便完成可达性算法</span></p><p>&nbsp;</p><h3><a name="安全点safepoint" class="md-header-anchor"></a><span>安全点[Safepoint]</span></h3><ol start='' ><li><span>一个特定的位置，用来生成</span><strong><span>OopMap</span></strong><span>。</span></li><li><span>这个位置的选取标准是</span><strong><span>让程序长时间执行的地方[例如方法调用、循环、异常跳转等]</span></strong><span>。</span></li><li><span>安全点数量不可过多，过多会影响性能。</span></li></ol><p>&nbsp;</p><p>&nbsp;</p><h3><a name="垃圾回收器分类" class="md-header-anchor"></a><span>垃圾回收器分类</span></h3><p><strong><span>新生代垃圾回收器</span></strong><span>[专门回收新生代] Serial、ParNew、Parallel Scavenge、G1</span>
<strong><span>老年代垃圾回收器</span></strong><span>[专门回收老年代] Serial Old、Parallel Old、CMS[Concurrent Mark Sweep]、G1</span></p><p><img src="img/垃圾回收器.png" alt="image-20190930192844545" style="zoom:27%;" /></p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="新生代的垃圾回收器" class="md-header-anchor"></a><span>新生代的垃圾回收器 </span></h3><h4><a name="serial" class="md-header-anchor"></a><span>Serial</span></h4><ol start='' ><li><span>单线程垃圾回收器。</span></li><li><span>采用复制算法回收新生代。</span></li><li><span>GC时，暂停所有用户线程。</span></li></ol><p><img src="img/Serial.png" alt="image-20190929150929581" style="zoom:20%;" align="left" /></p><p>&nbsp;</p><h4><a name="parnew" class="md-header-anchor"></a><span>ParNew</span></h4><ol start='' ><li><span>多线程垃圾回收器。其实是Serial的多线程版本。</span></li><li><span>也是采用复制算法回收新生代。</span></li><li><span>GC时，暂停所有用户线程。</span></li></ol><p><img src="img/ParNew.png" alt="image-20190929151035688" style="zoom:25%;" align="left"/></p><p>&nbsp;</p><h4><a name="parallel-scavenge" class="md-header-anchor"></a><span>Parallel Scavenge</span></h4><ol start='' ><li><p><span>多线程垃圾回收器。</span></p></li><li><p><span>采用复制算法回收新生代。</span></p></li><li><p><span>GC时，也会暂停所有用户线程。</span></p></li><li><p><span>这个回收器更加注重吞吐量，而不是缩短用户线程停顿时间。有利于提高CPU使用率，主要适合后台运算多且交互少的任务。</span></p><p><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="24.701ex" height="4.449ex" viewBox="0 -1190.3 10635.1 1915.7" role="img" focusable="false" style="vertical-align: -1.685ex;"><defs><path stroke-width="0" id="E1-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="0" id="E1-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E1-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path stroke-width="0" id="E1-MJMATHI-47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path><path stroke-width="0" id="E1-MJMATHI-43" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path stroke-width="0" id="E1-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.666) matrix(1 0 0 -1 0 0)">吞</text><g transform="translate(670,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.666) matrix(1 0 0 -1 0 0)">吐</text></g><g transform="translate(1340,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.666) matrix(1 0 0 -1 0 0)">量</text></g><use xlink:href="#E1-MJMAIN-3D" x="2287" y="0"></use><g transform="translate(3065,0)"><g transform="translate(397,0)"><rect stroke="none" width="7051" height="60" x="0" y="220"></rect><g transform="translate(1630,622)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">运</text><g transform="translate(473,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">行</text></g><g transform="translate(947,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">用</text></g><g transform="translate(1421,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">户</text></g><g transform="translate(1895,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">代</text></g><g transform="translate(2368,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">码</text></g><g transform="translate(2842,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">时</text></g><g transform="translate(3316,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">间</text></g></g><g transform="translate(60,-438)"><use transform="scale(0.707)" xlink:href="#E1-MJMAIN-28" x="0" y="0"></use><g transform="translate(275,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">运</text></g><g transform="translate(748,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">行</text></g><g transform="translate(1222,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">用</text></g><g transform="translate(1696,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">户</text></g><g transform="translate(2170,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">代</text></g><g transform="translate(2644,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">码</text></g><g transform="translate(3117,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">时</text></g><g transform="translate(3591,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">间</text></g><use transform="scale(0.707)" xlink:href="#E1-MJMAIN-2B" x="5749" y="0"></use><use transform="scale(0.707)" xlink:href="#E1-MJMATHI-47" x="6527" y="0"></use><use transform="scale(0.707)" xlink:href="#E1-MJMATHI-43" x="7313" y="0"></use><g transform="translate(5708,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">时</text></g><g transform="translate(6182,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(36.534) matrix(1 0 0 -1 0 0)">间</text></g><use transform="scale(0.707)" xlink:href="#E1-MJMAIN-29" x="9413" y="0"></use></g></g></g></g></svg></span><script type="math/tex">吞吐量=\frac{运行用户代码时间}{(运行用户代码时间+GC时间)}</script></p></li><li><p><span>控制吞吐量的参数</span></p><ol start='' ><li><span>-XX:MaxGCPauseMillis GC最长时间</span></li><li><span>-XX:GCTimeRatio 吞吐量大小</span></li><li><span>-XX:+UseAdaptiveSizePolicy 开启后，有些参数可以自动调配，不用人工调整。</span></li></ol></li></ol><p><img src="img/ParallelScavenge.png" alt="image-20190929151611392" style="zoom:25%;" align="left" /></p><p>&nbsp;</p><h3><a name="老年代的垃圾回收器" class="md-header-anchor"></a><span>老年代的垃圾回收器 </span></h3><h4><a name="serial-old" class="md-header-anchor"></a><span>Serial Old</span></h4><ol start='' ><li><span>单线程垃圾回收器。</span></li><li><span>采用</span><strong><span>标记-整理</span></strong><span>算法回收老年代。</span></li><li><span>GC时，暂停所有用户线程。</span></li></ol><p><img src="img/SerialOld.png" alt="image-20190930193356577" style="zoom:25%;" align="left" /></p><p>&nbsp;</p><h4><a name="parallel-old" class="md-header-anchor"></a><span>Parallel Old</span></h4><ol start='' ><li><span>多线程垃圾回收器。</span></li><li><span>采用</span><strong><span>标记-整理</span></strong><span>算法回收老年代。</span></li><li><span>GC时，也会暂停所有用户线程。</span></li></ol><p>&nbsp;</p><h4><a name="cmsconcurrent-mark-sweep" class="md-header-anchor"></a><span>CMS[Concurrent Mark Sweep]</span></h4><ol start='' ><li><p><span>以获得最短回收停顿时间[Stop-the-world]为目标的收集器。</span></p></li><li><p><span>采用</span><strong><span>标记-清除</span></strong><span>算法回收老年代。会产生空间碎片。</span></p></li><li><p><span>4个步骤。</span><strong><span>只有初始标记、重新标记会Stop-the-world，后者会比前者长。并发标记、并发清除耗时长。</span></strong></p><ol start='' ><li><strong><span>初始标记</span></strong><span>[CMS initial mark] 标记GC Roots直接关联的对象，速度快。</span></li><li><span>并发标记[CMS concurrent mark] 追溯GC Roots相连的对象。</span></li><li><strong><span>重新标记</span></strong><span>[CMS remark] 对并发标记期间因用户线程运行导致标记产生的变动进行修正。</span></li><li><span>并发清除[CMS concurrent sweep] </span></li></ol></li></ol><p>&nbsp;</p><p><img src="img/CMS.png" alt="image-20191004020843365" style="zoom:30%;" align="left"/></p><p>&nbsp;</p><h4><a name="g1garbage-first" class="md-header-anchor"></a><span>G1[Garbage First]</span></h4><ol start='' ><li><span>并行并发</span></li><li><span>分代收集。 新生代使用复制算法。老年代使用标记-整理算法</span></li><li><span>可预测停顿。可以指定停顿时间长度，不超过N毫秒。</span></li><li><span>将堆化成多个区域Region，新生代老年代不再物理隔离，它们由不连续的Region组成。后台维护优先列表，优先回收价值最大的Region。</span></li></ol><p>&nbsp;</p><h2><a name="垃圾回收参数调优" class="md-header-anchor"></a><span>垃圾回收参数调优</span></h2><p><span>-XX:SurvivorRatio Eden和Survivor的比例，默认8:1。</span></p><p><span>-XX:NewRatio 新生代和老年代的内存大小比例。</span></p><p><span>-XX:PretenuerSizeThreshold 对象直接进入老年代的最小阈值。</span></p><p><span>-XX:MaxTenuringThreshold 设置对象经历GC次数的最大阈值，超过这个次数放入老年代</span></p><p>&nbsp;</p><h3><a name="各个回收器组合" class="md-header-anchor"></a><span>各个回收器组合</span></h3><h4><a name="-xxuseserialgc" class="md-header-anchor"></a><span>-XX:+UseSerialGC</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Serial + Serial Old</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><h4><a name="-xxuseparnewgc" class="md-header-anchor"></a><span>-XX:+UseParNewGC</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ParNew + Serial Old</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><h4><a name="-xxuseparallelgc" class="md-header-anchor"></a><span>-XX:+UseParallelGC</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Parallel Scavenge + Serial Old</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><h4><a name="-xxuseparalleloldgc" class="md-header-anchor"></a><span>-XX:+UseParallelOldGC</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Parallel Scavenge + Parallel Old</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><h4><a name="-xxuseconcmarksweepgc" class="md-header-anchor"></a><span>-XX:+UseConcMarkSweepGC</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ParNew + CMS[Concurrent Mark Sweep] + Serial Old[CMS碎片过多时，备用标记-整理]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p>&nbsp;</p><h3><a name="jvm默认参数-gc回收器" class="md-header-anchor"></a><span>JVM默认参数 GC回收器</span></h3><p><strong><span>通过命令查询</span></strong><span>:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.986083984375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;</span> <span class="cm-variable">java</span> <span class="cm-operator">-</span><span class="cm-variable">XX</span>:<span class="cm-operator">+</span><span class="cm-variable">PrintCommandLineFlags</span> <span class="cm-operator">-</span><span class="cm-variable">XX</span>:<span class="cm-operator">+</span><span class="cm-variable">PrintGCDetails</span> <span class="cm-operator">-</span><span class="cm-variable">version</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p>&nbsp;</p><h1><a name="多线程与并发" class="md-header-anchor"></a><span>多线程与并发</span></h1><h2><a name="面试题-n926" class="md-header-anchor"></a><span>面试题</span></h2><h3><a name="thread中start和run方法的区别" class="md-header-anchor"></a><span>Thread中start和run方法的区别</span></h3><p><span>start: 会创建一个子线程</span>
<span>run: 线程执行的方法</span></p><h3><a name="thread-和-runnable-的区别" class="md-header-anchor"></a><span>Thread 和 Runnable 的区别</span></h3><p><span>Thread是个类实现了Runnable接口，Runnable接口只有一个run方法。</span></p><h3><a name="如何给run传参数" class="md-header-anchor"></a><span>如何给run传参数</span></h3><ol start='' ><li><span>构造参数</span></li><li><span>成员变量setter</span></li><li><span>回调函数</span></li></ol><h3><a name="处理线程返回值" class="md-header-anchor"></a><span>处理线程返回值</span></h3><ol start='' ><li><span>主线程等待直到子线程执行结束。</span></li><li><span>调用子线程Thread的join方法阻塞当前线程直到子线程执行完成。</span></li><li><span>使用Callable接口+[FutureTask+Thread]/[ExcutorService]实现。</span></li></ol><h3><a name="sleep和wait区别" class="md-header-anchor"></a><span>sleep和wait区别</span></h3><ol start='' ><li><span>sleep是Thread的方法，wait是Object的方法</span></li><li><span>sleep可以在任何地方使用，不会释放锁</span></li><li><span>wait只能在synchronized方法或synchronized代码块中使用，会释放锁</span></li></ol><h3><a name="notify-和-notifyall-区别" class="md-header-anchor"></a><span>notify 和 notifyAll 区别</span></h3><h4><a name="锁池-entrylist" class="md-header-anchor"></a><span>锁池 EntryList</span></h4><p><span>等待获取排它锁，竞争排它锁的线程集合。</span></p><h4><a name="等待池-waitset" class="md-header-anchor"></a><span>等待池 WaitSet</span></h4><p><span>调用wait方法后，线程进入等待池。</span></p><p><span>notify: 随机选取一个线程从等待池进入锁池，即让一个等待线程获得竞争锁的资格。</span></p><p><span>notifyAll: 所有等待池中的线程进入锁池，获得竞争资格。</span></p><h3><a name="theadyield" class="md-header-anchor"></a><span>Thead.yield()</span></h3><p><span>暗示程序调度器，愿意让出CPU时间，但调度器可能会忽视这个暗示。也不会让出锁。</span></p><h3><a name="threadinterrupt" class="md-header-anchor"></a><span>Thread.interrupt()</span></h3><p><span>通知线程应该被中断，但并不会被中断。调用时，</span></p><ul><li><span>线程在</span><strong><span>等待池</span></strong><span>中[指wait/timed wait状态]，抛出InterruptedException，并退出当前状态。</span></li><li><span>线程在锁池中[指阻塞Blocked状态]不会抛出任何异常，也不会终止线程。</span></li><li><span>处于活动状态，该线程的中断标记设置为true，然后继续运行，不受影响。</span></li></ul><p><strong><span>使用方法</span></strong><span>: 需要被调用的线程配合，在运行时要检查中断标记位，如果为true，就自行中断异常。</span></p><h3><a name="如何中断线程" class="md-header-anchor"></a><span>如何中断线程</span></h3><ul><li><span>deprecated方法，不安全</span>
<span>stop方法</span>
<span>suspend方法 + resume方法</span></li><li><span>安全的方法，调用interrupt方法。</span></li></ul><p>&nbsp;</p><h2><a name="java中线程状态" class="md-header-anchor"></a><span>Java中线程状态</span></h2><ul><li><p><strong><span>New</span></strong><span>[新建] 创建后尚未启动的线程</span></p></li><li><p><strong><span>Runnable</span></strong><span>[运行] 包括</span><strong><span>Ready</span></strong><span>[准备就绪] 和 </span><strong><span>Running</span></strong><span>[运行中] 两个状态，这两个状态会因为</span><strong><span>系统调度</span></strong><span>或者</span><strong><span>yield方法</span></strong><span>相互转换。</span></p><ul><li><span>Ready 等待分配CPU时间</span></li><li><span>Running 正在运行</span></li></ul></li><li><p><strong><span>Blocked</span></strong><span>[阻塞] 等待获取排它锁</span></p></li><li><p><strong><span>Waiting</span></strong><span>[等待] 不会被分配CPU时间，需要显示唤醒</span></p><ul><li><span>没设置时间的</span>
<span>Object.wait() </span>
<span>Thread.join() </span>
<span>LockSupport.park()</span></li></ul></li><li><p><strong><span>Timed Waiting</span></strong><span>[超时等待] 一定时间后由系统自动唤醒</span></p><ul><li><span>设置时间的</span>
<span>Object.wait(time) </span>
<span>Thread.join(time) </span>
<span>LockSupport.parkNanos() </span>
<span>LockSupport.parkUntil()</span></li></ul></li><li><p><strong><span>Terminated</span></strong><span>[终止] 线程结束执行</span></p></li></ul><p>&nbsp;</p><p><img src="img/线程状态.png" alt="线程状态" style="zoom:70%;" /></p><h2><a name="synchronized底层实现原理" class="md-header-anchor"></a><span>synchronized底层实现原理</span></h2><h3><a name="monitor" class="md-header-anchor"></a><span>Monitor</span></h3><p><span>synchronized实现依靠Monitor。每个对象都有一个Monitor对象，Monitor是个锁对象。包含以下字段:</span></p><ul><li><strong><span>EntryList</span></strong><span>锁池</span></li><li><strong><span>WaitSet</span></strong><span>等待池</span></li><li><strong><span>Owner</span></strong><span> 指向持有该锁的线程</span></li><li><strong><span>Counter</span></strong><span> 持有该锁的线程数</span></li></ul><p><img src="img/Monitor.png" alt="image-20191008182911562" style="zoom:35%;" align="left" /></p><p>&nbsp;</p><h3><a name="重入" class="md-header-anchor"></a><span>重入</span></h3><p><span>指一个线程已有某个资源锁时，此线程再次请求同一个资源锁。</span></p><p><span>synchronized具有可重入性。</span></p><p>&nbsp;</p><h2><a name="hotspot对锁的优化" class="md-header-anchor"></a><span>HotSpot对锁的优化</span></h2><h3><a name="synchronized的4种状态" class="md-header-anchor"></a><span>synchronized的4种状态</span></h3><p><strong><span>锁的膨胀方向由上到下</span></strong><span>:</span></p><ul><li><strong><span>无锁</span></strong><span> </span></li><li><strong><span>偏向锁</span></strong></li><li><strong><span>轻量级锁</span></strong><span> 使用自旋锁</span></li><li><strong><span>重量级锁</span></strong><span> </span></li></ul><p>&nbsp;</p><p><strong><span>锁的优化</span></strong><span>:</span></p><ul><li><strong><span>适应性自旋</span></strong><span> Adaptive Spinning</span></li><li><strong><span>锁消除</span></strong><span> Lock Elimination</span></li><li><strong><span>锁粗化</span></strong><span> Lock Coarsening</span></li><li><strong><span>偏向锁</span></strong><span> Biased Lock</span></li><li><strong><span>轻量级锁</span></strong><span> Lightweight Lock</span></li></ul><p>&nbsp;</p><h3><a name="自旋锁和自适应自旋" class="md-header-anchor"></a><span>自旋锁和自适应自旋</span></h3><p><strong><span>自旋锁</span></strong></p><p><span>许多情况下，共享数据的锁定状态持续时间短，线程的挂起、恢复操作消耗大。对等待线程进行优化，不放弃CPU资源，执行</span><strong><span>忙循环(自旋)</span></strong><span>，这就是自旋锁。</span></p><p><strong><span>缺点</span></strong><span>: 尽管可设置自旋次数，如果锁被占用很长时间，会带来更多的性能开销。</span></p><p>&nbsp;</p><p><strong><span>自适应自旋锁</span></strong></p><p><span>自旋次数不再固定，由前一次同一个锁上的自旋时间决定。</span></p><p>&nbsp;</p><h3><a name="锁消除" class="md-header-anchor"></a><span>锁消除</span></h3><p><span>JIT[Just-in-time]编译时，运行环境进行扫描，去除不可能存在竞争的锁。例如StringBuffer的append方法是synchronized方法，如果只有一个线程执行，那么这方法会被当成普通方法而非synchronized方法，提高运行速度。</span></p><p>&nbsp;</p><h3><a name="锁粗化" class="md-header-anchor"></a><span>锁粗化</span></h3><p><span>锁的粒度太细，有时候会导致反复加锁和解锁，加大开销，加大锁的范围，避免反复加锁和解锁。例如下面代码会粗化</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable-3">String</span> <span class="cm-def">get</span>(<span class="cm-variable-3">StringBuffer</span> <span class="cm-variable">sb</span>){</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">while</span>(<span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">100</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">sb</span>.<span class="cm-variable">append</span>(<span class="cm-string">"h"</span>); <span class="cm-comment">//把锁范围扩大到循环体，避免反复加锁、解锁</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 111px;"></div><div class="CodeMirror-gutters" style="display: none; height: 111px;"></div></div></div></pre><p>&nbsp;</p><h3><a name="偏向锁" class="md-header-anchor"></a><span>偏向锁</span></h3><p><span>线程在</span><strong><span>同步代码中，无竞争时，提高运行速度</span></strong><span>。偏向第一个获得锁的线程，如果没有另外一个线程获得这个锁，那么偏向的线程再次进入同步代码时可不进行同步操作。</span></p><p><strong><span>升级为轻量级锁</span></strong><span>: 当有另一个线程加入竞争时，升级锁。</span></p><p><strong><span>缺点</span></strong><span>: 多线程竞争大时，偏向锁是多余的。</span></p><p>&nbsp;</p><p>&nbsp;</p><h2><a name="reentrantlock-再入锁" class="md-header-anchor"></a><span>ReentrantLock 再入锁</span></h2><ul><li><span>和CountDownLatch、FutureTask、Semaphore一样，都是基于AQS[AbstractQueuedSynchronizer]实现。</span></li><li><span>可控性更高，实现比synchronized粒度更小的控制，如控制fairness公平性、判断是否获得锁。</span></li><li><span>可通过Condition实现wait、notify的功能。</span></li><li><span>调用lock()方法后要调用unlock()方法释放锁。</span></li><li><span>性能不一定比synchronized高</span></li><li><span>可重入</span></li></ul><p><strong><span>fiarness 公平性</span></strong><span>: 倾向于将锁给等待时间最久的线程。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ReentrantLock</span> <span class="cm-variable">fairLock</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ReentrantLock</span>(<span class="cm-atom">true</span>); <span class="cm-comment">// 公平锁</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p>&nbsp;</p><h2><a name="java内存模型-jmm" class="md-header-anchor"></a><span>Java内存模型 JMM</span></h2><p><img src="img/java内存模型.png" alt="image-20191008223502180" style="zoom:40%;" /></p><p><strong><span>JMM</span></strong><span> 和 </span><strong><span>java内存区域划分</span></strong><span>的区别: JMM是规则、规范，它并不存在，只是定义了各个变量的访问方式，但都存在共享区域和私有区域。</span></p><p><strong><span>规范</span></strong><span>: </span></p><ul><li><span>方法中的基本数据类型、对象引用直接存储在</span><strong><span>工作内存[线程私有]</span></strong><span>的栈帧中。</span></li><li><span>对象实例、成员变量、类信息、static变量存储在</span><strong><span>主内存[线程共享]</span></strong><span>中。</span></li><li><span>主内存的数据操作方式是，线程复制一个副本到</span><strong><span>工作内存</span></strong><span>中，完成操作后，写回</span><strong><span>主内存</span></strong><span>中。</span></li></ul><h3><a name="指令重排序" class="md-header-anchor"></a><span>指令重排序</span></h3><p><span>要满足以下条件:</span></p><ul><li><span>单线程环境不能改变运行结果</span></li><li><span>存在数据依赖关系不能重拍</span></li><li><span>不符合</span><strong><span>happens-before</span></strong><span>的规则</span></li></ul><h3><a name="happens-before" class="md-header-anchor"></a><span>Happens-before</span></h3><ol start='' ><li><span>程序顺序规则: 单线程，前面代码发生在后面代码之前。</span></li><li><span>锁定规则: 前面的解锁操作先于后面的加锁操作。</span></li><li><span>volatile变量规则: 对一个变量的前面的写操作先于后面的读操作。</span></li><li><span>传递规则: 如果操作A发生先于操作B，操作B先于操作C，那么操作A先于操作C。</span></li><li><span>线程启动规则: start方法先于此线程的每一个动作。</span></li><li><span>线程中断规则: 前面的interrupt方法先于后面被中断线程isInterrupt方法的执行</span></li><li><span>线程终结规则: 线程中所有操作先于线程终止检测[Thread.join/isAlive...]</span></li><li><span>对象终结规则: 一个对象的初始化先于finalize方法。</span></li></ol><p>&nbsp;</p><h2><a name="volatile" class="md-header-anchor"></a><span>volatile</span></h2><h3><a name="volatile的可见性" class="md-header-anchor"></a><span>volatile的可见性</span></h3><p><strong><span>非volatile变量的不可见性:</span></strong></p><p><img src="img/不可见性.png" alt="image-20191011140446862" style="zoom:40%;" /></p><p><strong><span>JVM提供的轻量级同步机制</span></strong></p><ul><li><strong><span>可见性</span></strong><span>。保证volatile的共享变量的修改对所有线程总是</span><strong><span>立即可见</span></strong><span>。任何改变都会立刻反映到主内存中。</span></li><li><strong><span>禁止指令重排</span></strong></li></ul><p><strong><span>volatile为何立即可见？</span></strong>
<strong><span>写</span></strong><span>: 将值直接写到主内存中。</span>
<strong><span>读</span></strong><span>: 每次都从主内存中读取。</span></p><h3><a name="单例类的双重检验" class="md-header-anchor"></a><span>单例类的双重检验</span></h3><p><span>用volatile可禁止指令重排，避免错误</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="page-break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">volatile</span> <span class="cm-keyword">static</span> <span class="cm-variable">Singleton</span> <span class="cm-variable">instance</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable">Singleton</span> <span class="cm-def">getInstance</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">instance</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">synchronized</span>(<span class="cm-variable">Singleton</span>.<span class="cm-keyword">class</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">instance</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">instance</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Singleton</span>(); <span class="cm-comment">// new Singleton();有3个指令，非原子操作，可能发生指令重排</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">instance</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">new Singleton():</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">重排前</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">memory = allocate(); // 1. 分配对象内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">instance(memory); // 2. 调用instance方法初始化对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">instance = memory; // 3. 设置instance指向刚分配的内存空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">重排后2和3顺序可能会被调换，此时instance!=null，但初始化还没完成，会发生错误。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">*/</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 489px;"></div><div class="CodeMirror-gutters" style="display: none; height: 489px;"></div></div></div></pre><p>&nbsp;</p><h3><a name="volatile-和--synchronized的区别" class="md-header-anchor"></a><span>volatile 和  synchronized的区别</span></h3><ol start='' ><li><span>volatile本质是告诉JVM当期变量在工作内存中的值不确定，要去主内存中读取；synchronized是坐定当前变量，只有当前线程可以访问、操作，其他线程会被阻塞直到变量操作结束。</span></li><li><span>volatile只保证可见性，不保证原子性。synchronized两个都保证。</span></li><li><span>volatile不造成阻塞；synchronized可能会阻塞。</span></li><li><span>volatile标记的变量不会被编译器优化、指令重排；synchronized可以被优化。</span></li></ol><p>&nbsp;</p><h2><a name="cas-compare-and-swap" class="md-header-anchor"></a><span>CAS [Compare and Swap]</span></h2><p><span>一种高效实现线程安全性的方法，乐观锁lock-free。</span></p><p><strong><span>实现</span></strong><span>: 包含3个操作数 内存位置V、预期原值A、新值B，先对比内存中的值是否为A，如果是则修改值为B，否则返回更新失败。</span></p><h3><a name="aba问题" class="md-header-anchor"></a><span>ABA问题</span></h3><p><span>如果一个值是A，然后被改成B，最后又改回B时，如果之对比预期原值会认为这个值没被改变。Java中使用AtomicStampedReference解决ABA问题解决。</span></p><p>&nbsp;</p><h2><a name="线程池" class="md-header-anchor"></a><span>线程池</span></h2><h3><a name="为什么会用线程池" class="md-header-anchor"></a><span>为什么会用线程池</span></h3><p><span>处理大量短时间任务时，会有大量的时间消耗在线程创建和销毁上，线程池可以减少这种消耗。</span></p><h3><a name="java线程池框架" class="md-header-anchor"></a><span>Java线程池框架</span></h3><p>&nbsp;</p><p><img src="img/Executor框架.png" alt="image-20191010140023494" style="zoom:30%;" /></p><p><strong><span>Executor</span></strong><span>接口和</span><strong><span>ExecutorService</span></strong><span>接口为</span><strong><span>任务执行细节</span></strong><span>和</span><strong><span>提交</span></strong><span>起到</span><strong><span>解耦</span></strong><span>作用:</span>
<strong><span>Executor</span></strong><span>接口只负责任务运行。</span>
<strong><span>ExecutorService</span></strong><span>接口负责任务提交，还有管理线程。</span></p><h4><a name="executor接口" class="md-header-anchor"></a><span>Executor接口</span></h4><p><span>运行任务的简单接口，只负责执行任务。接口只有一个方法:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">execute</span>(<span class="cm-variable">Runnable</span> <span class="cm-variable">command</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p>&nbsp;</p><h4><a name="executorservice接口" class="md-header-anchor"></a><span>ExecutorService接口</span></h4><p><span> 继承Executor接口，提供任务提交、任务管理的接口。</span></p><p>&nbsp;</p><h4><a name="scheduledexecutorservice接口" class="md-header-anchor"></a><span>ScheduledExecutorService接口</span></h4><p><span>继承ExecutorService接口，提供定时任务提交的接口。</span></p><p>&nbsp;</p><h4><a name="executors" class="md-header-anchor"></a><span>Executors</span></h4><p><strong><span>使用Executors创建不同的线程池满足不同的需求</span></strong><span>:</span></p><p><span>返回</span><strong><span>ThreadPoolExecutor</span></strong><span>:</span></p><ol start='' ><li><p><strong><span>newFixedThreadPool(int)</span></strong><span> 指定工作线程池</span></p></li><li><p><strong><span>newCachedThreadPool()</span></strong><span> 处理大量短时间任务的线程池</span></p><ol start='' ><li><span>缓存线程来并重用，没有可用缓存线程时，创建新的线程</span></li><li><span>缓存线程闲置时间过长，会被移除缓存、销毁。</span></li><li><span>系统长时间闲置的时候不会消耗资源</span></li></ol></li><li><p><strong><span>newSingleThreadExecutor()</span></strong><span> 创建单一线程来执行任务，如果线程异常，会创建新的线程取代它。</span></p></li></ol><p><span>返回</span><strong><span>ScheduledThreadPoolExecutor</span></strong><span>:</span></p><ol start='2' ><li><strong><span>newSingleThreadScheduleExecutor()</span></strong><span>和</span><strong><span>newScheduledThreadPool(int)</span></strong><span> 定时任务，区别只在于是单一线程还是多线程。</span></li><li><strong><span>newWorkStealingPool()</span></strong><span> 内建ForkJoinPool</span></li></ol><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h1><a name="java异常" class="md-header-anchor"></a><span>Java异常</span></h1><h2><a name="异常机制主要回答三个问题" class="md-header-anchor"></a><span>异常机制主要回答三个问题</span></h2><p><strong><span>What</span></strong><span>: </span><strong><span>异常类型</span></strong><span>回答什么异常被抛出</span></p><p><strong><span>Where</span></strong><span>: </span><strong><span>异常堆栈跟踪</span></strong><span>回答哪里抛出</span></p><p><strong><span>Why</span></strong><span>: </span><strong><span>异常信息</span></strong><span>回答为什么抛出</span></p><p>&nbsp;</p><h2><a name="异常体系" class="md-header-anchor"></a><span>异常体系</span></h2><p><img src="img/异常体系.png" alt="image-20191010153554499" style="zoom:40%;" /></p><p><strong><span>Error</span></strong><span>: 程序</span><strong><span>无法处理</span></strong><span>的系统错误。编译器不做检查。</span>
<strong><span>Exception</span></strong><span>: 程序</span><strong><span>可处理</span></strong><span>得异常，捕捉后可恢复。</span>
<span>	</span><strong><span>RuntimeException</span></strong><span>: 不可预知，编译器不检查。</span>
<span>	</span><strong><span>CheckedException/非RuntimeException</span></strong><span>: 可预知，编译器检查。</span></p><p>&nbsp;</p><h1><a name="集合" class="md-header-anchor"></a><span>集合</span></h1><p><img src="img/集合框架.png" alt="collection" style="zoom:78%;" /></p><p><strong><span>List</span></strong><span>: 有序[存入取出的顺序一致]，可重复</span>
<strong><span>Set</span></strong><span>: 无序，不可重复</span></p><p><strong><span>ArrayList</span></strong><span>: 数组实现。查询快、增删慢。线程不安全</span>
<strong><span>Vector</span></strong><span>: 数组实现。 查询快、增删慢。线程安全</span>
<strong><span>LinkedList</span></strong><span>: 链表实现。查询慢、增删快。线程不安全</span></p><p><strong><span>HashMap</span></strong><span>: 可存null。数组+链表/红黑树。线程不安全</span>
<strong><span>HashTable</span></strong><span>:不可存null。数组+链表。线程不安全</span>
<strong><span>ConcurrentHashMap</span></strong><span> 不可存null。数组+链表/红黑树。线程安全</span></p><h2><a name="hashmap" class="md-header-anchor"></a><span>HashMap</span></h2><p><span>HashMap使用延迟初始化，put之后才开始初始化。</span><strong><span>适合存储key值不可变的元素。</span></strong>
<span>Java8以前: 数组+链表</span>
<span>Java8: 数组+链表/红黑树</span></p><p>&nbsp;</p><h3><a name="减少hash碰撞" class="md-header-anchor"></a><span>减少hash碰撞</span></h3><p><span>把hash值高16位和低16位做异或运算。增加随机性。</span></p><p>&nbsp;</p><h3><a name="为什么map大小总是2n" class="md-header-anchor"></a><span>为什么Map大小总是</span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.379ex" height="1.846ex" viewBox="0 -759.9 1024.3 794.8" role="img" focusable="false" style="vertical-align: -0.081ex;"><defs><path stroke-width="0" id="E2-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path stroke-width="0" id="E2-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E2-MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E2-MJMATHI-6E" x="707" y="555"></use></g></svg></span><script type="math/tex">{2^n}</script></h3><p><span>为了提高计算下标的速度。用hash值计算下标时，如果用</span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.988ex" height="2.289ex" viewBox="0 -828.7 4731 985.7" role="img" focusable="false" style="vertical-align: -0.365ex;"><defs><path stroke-width="0" id="E6-MJMATHI-68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path stroke-width="0" id="E6-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path stroke-width="0" id="E6-MJMATHI-73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path stroke-width="0" id="E6-MJMAIN-25" d="M465 605Q428 605 394 614T340 632T319 641Q332 608 332 548Q332 458 293 403T202 347Q145 347 101 402T56 548Q56 637 101 693T202 750Q241 750 272 719Q359 642 464 642Q580 642 650 732Q662 748 668 749Q670 750 673 750Q682 750 688 743T693 726Q178 -47 170 -52Q166 -56 160 -56Q147 -56 142 -45Q137 -36 142 -27Q143 -24 363 304Q469 462 525 546T581 630Q528 605 465 605ZM207 385Q235 385 263 427T292 548Q292 617 267 664T200 712Q193 712 186 709T167 698T147 668T134 615Q132 595 132 548V527Q132 436 165 403Q183 385 203 385H207ZM500 146Q500 234 544 290T647 347Q699 347 737 292T776 146T737 0T646 -56Q590 -56 545 0T500 146ZM651 -18Q679 -18 707 24T736 146Q736 215 711 262T644 309Q637 309 630 306T611 295T591 265T578 212Q577 200 577 146V124Q577 -18 647 -18H651Z"></path><path stroke-width="0" id="E6-MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E6-MJMATHI-7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path><path stroke-width="0" id="E6-MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E6-MJMATHI-68" x="0" y="0"></use><use xlink:href="#E6-MJMATHI-61" x="576" y="0"></use><use xlink:href="#E6-MJMATHI-73" x="1105" y="0"></use><use xlink:href="#E6-MJMATHI-68" x="1574" y="0"></use><use xlink:href="#E6-MJMAIN-25" x="2150" y="0"></use><use xlink:href="#E6-MJMATHI-73" x="2983" y="0"></use><use xlink:href="#E6-MJMATHI-69" x="3452" y="0"></use><use xlink:href="#E6-MJMATHI-7A" x="3797" y="0"></use><use xlink:href="#E6-MJMATHI-65" x="4265" y="0"></use></g></svg></span><script type="math/tex">{hash\%size}</script><span>计算速度会慢。</span></p><p><span>当</span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.536ex" height="2.049ex" viewBox="0 -777 4105.8 882.3" role="img" focusable="false" style="vertical-align: -0.245ex;"><defs><path stroke-width="0" id="E4-MJMATHI-73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path stroke-width="0" id="E4-MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E4-MJMATHI-7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path><path stroke-width="0" id="E4-MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path stroke-width="0" id="E4-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="0" id="E4-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path stroke-width="0" id="E4-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E4-MJMATHI-73" x="0" y="0"></use><use xlink:href="#E4-MJMATHI-69" x="469" y="0"></use><use xlink:href="#E4-MJMATHI-7A" x="814" y="0"></use><use xlink:href="#E4-MJMATHI-65" x="1282" y="0"></use><use xlink:href="#E4-MJMAIN-3D" x="2025" y="0"></use><g transform="translate(3081,0)"><use xlink:href="#E4-MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E4-MJMATHI-6E" x="707" y="555"></use></g></g></svg></span><script type="math/tex">size=2^n</script><span>时，以下两个公式等价。&amp;运算比%运算更快。</span>
<span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.668ex" height="2.649ex" viewBox="0 -828.7 7176.4 1140.7" role="img" focusable="false" style="vertical-align: -0.725ex;"><defs><path stroke-width="0" id="E5-MJMATHI-68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path stroke-width="0" id="E5-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path stroke-width="0" id="E5-MJMATHI-73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path stroke-width="0" id="E5-MJMAIN-26" d="M156 540Q156 620 201 668T302 716Q354 716 377 671T401 578Q401 505 287 386L274 373Q309 285 416 148L429 132L437 142Q474 191 543 309L562 341V349Q562 368 541 376T498 385H493V431H502L626 428Q709 428 721 431H727V385H712Q688 384 669 379T639 369T618 354T603 337T591 316T578 295Q537 223 506 176T464 117T454 104Q454 102 471 85T497 62Q543 24 585 24Q618 24 648 48T682 113V121H722V112Q721 94 714 75T692 32T646 -7T574 -22Q491 -19 414 42L402 51L391 42Q312 -22 224 -22Q144 -22 93 25T42 135Q42 153 46 169T55 197T74 225T96 249T125 278T156 308L195 347L190 360Q185 372 182 382T174 411T165 448T159 491T156 540ZM361 576Q361 613 348 646T305 679Q272 679 252 649T232 572Q232 497 255 426L259 411L267 420Q361 519 361 576ZM140 164Q140 103 167 64T240 24Q271 24 304 36T356 61T374 77Q295 156 235 262L220 292L210 310L193 293Q177 277 169 268T151 229T140 164Z"></path><path stroke-width="0" id="E5-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E5-MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E5-MJMATHI-7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path><path stroke-width="0" id="E5-MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path stroke-width="0" id="E5-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="0" id="E5-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="0" id="E5-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E5-MJMATHI-68" x="0" y="0"></use><use xlink:href="#E5-MJMATHI-61" x="576" y="0"></use><use xlink:href="#E5-MJMATHI-73" x="1105" y="0"></use><use xlink:href="#E5-MJMATHI-68" x="1574" y="0"></use><use xlink:href="#E5-MJMAIN-26" x="2150" y="0"></use><use xlink:href="#E5-MJMAIN-28" x="2928" y="0"></use><use xlink:href="#E5-MJMATHI-73" x="3317" y="0"></use><use xlink:href="#E5-MJMATHI-69" x="3786" y="0"></use><use xlink:href="#E5-MJMATHI-7A" x="4131" y="0"></use><use xlink:href="#E5-MJMATHI-65" x="4599" y="0"></use><use xlink:href="#E5-MJMAIN-2212" x="5287" y="0"></use><use xlink:href="#E5-MJMAIN-31" x="6287" y="0"></use><use xlink:href="#E5-MJMAIN-29" x="6787" y="0"></use></g></svg></span><script type="math/tex">hash\&(size-1)</script><span> == </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.988ex" height="2.289ex" viewBox="0 -828.7 4731 985.7" role="img" focusable="false" style="vertical-align: -0.365ex;"><defs><path stroke-width="0" id="E6-MJMATHI-68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path stroke-width="0" id="E6-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path stroke-width="0" id="E6-MJMATHI-73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path stroke-width="0" id="E6-MJMAIN-25" d="M465 605Q428 605 394 614T340 632T319 641Q332 608 332 548Q332 458 293 403T202 347Q145 347 101 402T56 548Q56 637 101 693T202 750Q241 750 272 719Q359 642 464 642Q580 642 650 732Q662 748 668 749Q670 750 673 750Q682 750 688 743T693 726Q178 -47 170 -52Q166 -56 160 -56Q147 -56 142 -45Q137 -36 142 -27Q143 -24 363 304Q469 462 525 546T581 630Q528 605 465 605ZM207 385Q235 385 263 427T292 548Q292 617 267 664T200 712Q193 712 186 709T167 698T147 668T134 615Q132 595 132 548V527Q132 436 165 403Q183 385 203 385H207ZM500 146Q500 234 544 290T647 347Q699 347 737 292T776 146T737 0T646 -56Q590 -56 545 0T500 146ZM651 -18Q679 -18 707 24T736 146Q736 215 711 262T644 309Q637 309 630 306T611 295T591 265T578 212Q577 200 577 146V124Q577 -18 647 -18H651Z"></path><path stroke-width="0" id="E6-MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="0" id="E6-MJMATHI-7A" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path><path stroke-width="0" id="E6-MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E6-MJMATHI-68" x="0" y="0"></use><use xlink:href="#E6-MJMATHI-61" x="576" y="0"></use><use xlink:href="#E6-MJMATHI-73" x="1105" y="0"></use><use xlink:href="#E6-MJMATHI-68" x="1574" y="0"></use><use xlink:href="#E6-MJMAIN-25" x="2150" y="0"></use><use xlink:href="#E6-MJMATHI-73" x="2983" y="0"></use><use xlink:href="#E6-MJMATHI-69" x="3452" y="0"></use><use xlink:href="#E6-MJMATHI-7A" x="3797" y="0"></use><use xlink:href="#E6-MJMATHI-65" x="4265" y="0"></use></g></svg></span><script type="math/tex">{hash\%size}</script></p><p>&nbsp;</p><p><img src="img/hash计算.png" alt="image-20191011131649186" style="zoom:50%;" /></p><h3><a name="putk-key-v-val" class="md-header-anchor"></a><span>put(K key, V val)</span></h3><ol start='' ><li><span>如果map没有初始化，则通过resize()初始化。</span></li><li><span>计算key的hash值，将高16位与低16位做异或运算，然后跟size-1进行&amp;运算得出下标。</span></li><li><span>如果没有hash碰撞，则存入。</span></li><li><span>如果碰撞了，桶内没有equals的key，放到链表最后面。</span></li><li><span>如果桶内元素个数大于TREEIFY_THRESHOLD，则将链表转化为红黑树。</span></li><li><span>如果通内存在这个值，则替换旧值。</span></li><li><span>如果map的元素个数大于THRESHOLD，通过resize()扩容。</span></li></ol><p>&nbsp;</p><h3><a name="使hashmap线程安全" class="md-header-anchor"></a><span>使HashMap线程安全</span></h3><p><span>通过调用Collections.synchronizedMap(HashMap)获得线程安全的map，返回的map与HashTable相似，只是锁的对象不一样，返回的map锁的是Object mutex对象；HashTable锁的是this对象。</span></p><p>&nbsp;</p><h2><a name="concurrenthashmap" class="md-header-anchor"></a><span>ConcurrentHashMap</span></h2><p><span>对HashTable进行优化，HashTable的锁范围是方法级别的，可以通过使锁粒度更细进行优化。</span></p><p><span>早期ConcurrentHashMap使用的是Segment分段锁，将table分成不同的段，对段上锁。</span><strong><span>数据结构</span></strong><span>: 数组+链表</span></p><p><span>后期，更加的细化锁的大小。对table里的每个桶配一把锁。用</span><strong><span>CAS+synchronized</span></strong><span>来锁。</span><strong><span>数据结构</span></strong><span>: 数组+链表/红黑树</span></p><p>&nbsp;</p><h3><a name="putk-key-v-val-n1255" class="md-header-anchor"></a><span>put(K key, V Val)</span></h3><ol start='' ><li><span>如果map没有初始化，则初始化</span></li><li><span>用key的hash值计算下标</span></li><li><span>如果没有hash碰撞。通过CAS插入，失败则重新插入尝试。</span></li><li><span>如果碰撞，则用synchronized代码块锁桶的第一个元素。</span></li><li><span>如果桶内是有相同元素，直接替换旧值。</span></li><li><span>如果没有，插入到链表末尾。</span></li><li><span>检查链表大小，过大转换为红黑树。</span></li><li><span>如果map过大，扩容。</span></li></ol><p>&nbsp;</p><h1><a name="juc包" class="md-header-anchor"></a><span>JUC包</span></h1><p><span>类的种类:</span></p><ol start='' ><li><span>线程执行器Executor</span></li><li><span>锁Lock</span></li><li><span>原子变量类Atomic</span></li><li><span>并发工具类</span></li><li><span>并发集合类</span></li></ol><p><img src="img/juc包的类.png" alt="image-20191011140135029" style="zoom:70%;" /></p><h2><a name="并发工具类" class="md-header-anchor"></a><span>并发工具类</span></h2><ol start='' ><li><span>CountDownLatch</span></li><li><span>CyclicBarrier</span></li><li><span>Semaphore</span></li><li><span>Exchanger</span></li></ol><p>&nbsp;</p><h3><a name="countdownlatch" class="md-header-anchor"></a><span>CountDownLatch</span></h3><p><span>让一个线程等待一组事件发生后继续执行。</span></p><p><strong><span>实现</span></strong><span>: 初始化一个值cnt，主线程调用await()，cnt大于0时阻塞；每当其他线程调用countDown()这个cnt减1，这些线程调用后不阻塞继续执行。当cnt等于0时，主线程恢复运行。</span></p><p><img src="img/CountDownLatch.png" alt="image-20191011141145016" style="zoom:40%;" /></p><h3><a name="cyclicbarrier" class="md-header-anchor"></a><span>CyclicBarrier</span></h3><p><span>让所有线程阻塞，直到所有线程到达某个点后恢复所有线程。与CountDownLatch区别是子线程也会阻塞。</span></p><p><span>实现: 初始化一个值cnt，当线程调用await()后阻塞并且这个cnt减1。如果cnt等于0，则恢复所有阻塞的线程。</span></p><p><img src="img/CyclicBarrier.png" alt="image-20191011141622378" style="zoom:40%;" /></p><h3><a name="semaphore" class="md-header-anchor"></a><span>Semaphore</span></h3><p><span>控制某个资源可被同时访问的线程个数。</span></p><p><strong><span>实现</span></strong><span>: 设置限制的个数x。当线程请求资源时调用acquire()方法，x大于0时，x减1；否则阻塞，等待其他线程释放资源，调用release()使x加1。</span></p><p><img src="img/Semaphore.png" alt="image-20191011142357496" style="zoom:30%;" /></p><h3><a name="exchanger" class="md-header-anchor"></a><span>Exchanger</span></h3><p><span>两个线程到达同步点后，相互交换数据。另一方没到达则阻塞线程。</span></p><p><strong><span>实现</span></strong><span>: 调用exchange(T t)方法，阻塞直到另一个线程也运行这个方法。</span></p><p><img src="img/Exchanger.png" alt="image-20191011142952724" style="zoom:28%;" /></p><p>&nbsp;</p><h2><a name="并发集合类" class="md-header-anchor"></a><span>并发集合类</span></h2><h3><a name="blockingqueue" class="md-header-anchor"></a><span>BlockingQueue</span></h3><p><span>提供可阻塞的入队和出队操作。主要用于生产消费者模式。</span></p><p><img src="img/BlockingQueue.png" alt="image-20191011143459827" style="zoom:28%;" /></p><h4><a name="实现类-都是线程安全的" class="md-header-anchor"></a><span>实现类 都是线程安全的。</span></h4><ol start='' ><li><strong><span>ArrayBlockingQueue</span></strong></li><li><strong><span>LinkedBlockingQueue</span></strong></li><li><strong><span>PriorityBlockingQueue</span></strong></li><li><span>DelayQueue</span></li><li><span>SynchronousQueue</span></li><li><span>LinkedTransferQueue</span></li><li><span>LinkedBlockingDeque</span></li></ol><p>&nbsp;</p><h1><a name="io" class="md-header-anchor"></a><span>IO</span></h1><h2><a name="bio-阻塞io" class="md-header-anchor"></a><span>BIO 阻塞IO</span></h2><p><img src="img/BIO.png" alt="image-20191011145134513" style="zoom:20%;" /></p><p><span>InputSream/OutputStream 字节流</span>
<span>Reader/Writer 字符流</span></p><h2><a name="nio-非阻塞io" class="md-header-anchor"></a><span>NIO 非阻塞IO</span></h2><p><span>多路复用的、同步非阻塞IO</span></p><p><img src="img/NIO.png" alt="image-20191011145413468" style="zoom:20%;" /></p><h3><a name="channel" class="md-header-anchor"></a><span>Channel</span></h3><ol start='' ><li><span>FileChannel</span></li><li><span>DatagramChannel</span></li><li><span>SocketChannel/ServerSocketChannel</span></li></ol><p><span>transferTo/transferFrom操作支持channel拷贝，并且这种拷贝可以避免数据从内核复制到用户空间。效率高。</span></p><h3><a name="buffer" class="md-header-anchor"></a><span>Buffer</span></h3><ol start='' ><li><span>ByteBuffer</span></li><li><span>CharBuffer</span></li><li><span>Float/DoubleBuffer</span></li><li><span>Short/Int/LongBuffer</span></li><li><span>MappedByteBuffer</span></li></ol><h3><a name="selector-io多路复用" class="md-header-anchor"></a><span>Selector IO多路复用</span></h3><p><img src="img/Selector.png" alt="image-20191011150152174" style="zoom:20%;" /></p><p>&nbsp;</p><p><strong><span>Selector</span></strong><span>: 调用系统级别的</span><strong><span>select</span></strong><span>/</span><strong><span>poll</span></strong><span>/</span><strong><span>epoll</span></strong></p><p><img src="img/spe.png" alt="image-20191011150338894" style="zoom:30%;" /></p><p>&nbsp;</p><figure><table><thead><tr><th><span>方式</span></th><th><span>最大连接数</span></th><th><span>IO效率</span></th><th><span>消息传递方式</span></th></tr></thead><tbody><tr><td><span>select</span></td><td><span>32位机器 32*32=1024；64位机器 32</span><span>*</span><span>64=2048</span></td><td><span>对连接线性遍历，随着连接数上升而降低</span></td><td><span>要将数据从内核拷贝到用户空间</span></td></tr><tr><td><span>poll[与select相似]</span></td><td><span>使用链表存储，没有上限。</span></td><td><span>同上</span></td><td><span>同上</span></td></tr><tr><td><span>epoll</span></td><td><span>又上限，但很大。1G机器可打开10万连接。</span></td><td><span>连接数上升影响较小。因为不用遍历连接，活跃连接会调用callback函数通知系统。</span></td><td><span>让内核和用户空间共享一块内存，性能较高</span></td></tr></tbody></table></figure><p>&nbsp;</p><h2><a name="aio-异步io" class="md-header-anchor"></a><span>AIO 异步IO</span></h2><p><img src="img/AIO.png" alt="image-20191011151853668" style="zoom:20%;" /></p><h2><a name="对比" class="md-header-anchor"></a><span>对比</span></h2><figure><table><thead><tr><th><span>属性/模型</span></th><th><span>BIO</span></th><th><span>NIO</span></th><th><span>AIO</span></th></tr></thead><tbody><tr><td><span>阻塞</span></td><td><span>阻塞，同步</span></td><td><span>非阻塞，同步</span></td><td><span>非阻塞，异步</span></td></tr><tr><td><span>线程数[server:client]</span></td><td><span>1:1</span></td><td><span>1:N</span></td><td><span>0:N</span></td></tr><tr><td><span>复杂度</span></td><td><span>简单</span></td><td><span>较复杂</span></td><td><span>复杂</span></td></tr><tr><td><span>吞吐量</span></td><td><span>低</span></td><td><span>高</span></td><td><span>高</span></td></tr></tbody></table></figure><p>&nbsp;</p><h1><a name="spring" class="md-header-anchor"></a><span>Spring</span></h1><h2><a name="特点" class="md-header-anchor"></a><span>特点</span></h2><h3><a name="spring优点" class="md-header-anchor"></a><span>Spring优点</span></h3><p><strong><span>低侵入式</span></strong><span>: 项目里的类不实现或继承框架里的接口或类。代码污染低。</span>
<strong><span>易扩展</span></strong><span>: 对其他框架提供支持。如Struts、Mybatis、Hibernate。</span>
<strong><span>解耦</span></strong><span>: 降低对象之间的耦合，通过IOC容器管理对象，避免硬编码过度耦合。</span></p><p>&nbsp;</p><h3><a name="spring中的模块" class="md-header-anchor"></a><span>Spring中的模块</span></h3><p><img src="img/spring模块.png" alt="spring" style="zoom:85%;" /></p><p><span>Core Container: 核心容器。</span>
<span>Context: Spring上下文，向Spring提供配置信息</span>
<span>ORM</span>
<span>JDBC</span>
<span>AOP</span></p><h3><a name="依赖倒置控制反转iocioc容器依赖注入di-的关系" class="md-header-anchor"></a><span>依赖倒置&amp;控制反转[IOC]&amp;IOC容器&amp;依赖注入DI 的关系</span></h3><p><img src="img/关系.png" alt="image-20191012144555979" style="zoom:30%;" /></p><p><strong><span>依赖倒置</span></strong><span>: 是一种思想。上层模块不应依赖下层模块，而应该依赖其抽象。</span></p><p><strong><span>控制反转[IOC]</span></strong><span>: </span><strong><span>对象创建</span></strong><span>和</span><strong><span>对象之间关系管理</span></strong><span>原本是用硬编码管理的，现在交给</span><strong><span>IOC容器</span></strong><span>管理，这就是</span><strong><span>控制反转</span></strong><span>。减少代码之间的耦合。常见的实现方式是</span><strong><span>依赖注入[DI]</span></strong><span>。</span></p><p><strong><span>依赖注入[DI]</span></strong><span>的4种注入方式:</span></p><ol start='' ><li><span>setter</span></li><li><span>构造函数</span></li><li><span>Annotation注解</span></li><li><span>Interface</span></li></ol><p>&nbsp;</p><h2><a name="srping-ioc" class="md-header-anchor"></a><span>Srping IOC</span></h2><p><strong><span>支持的功能</span></strong><span>: </span><strong><span>依赖注入</span></strong><span>/检查，</span><strong><span>自动装配</span></strong><span>、支持集合、指定初始化方法/销毁方法、支持回调方法。</span></p><p>&nbsp;</p><h3><a name="ioc初始化过程" class="md-header-anchor"></a><span>IOC初始化过程</span></h3><p><a href='https://blog.csdn.net/gchd19921992/article/details/79097969' target='_blank' class='url'>https://blog.csdn.net/gchd19921992/article/details/79097969</a></p><ul><li><span>BeanDefinition的Resouce定位和读取</span></li><li><span>载入注册</span></li><li><span>生成实例 缓存</span></li></ul><p><img src="img/IOC初始.png" alt="image-2019102221531956" style="zoom:40%;" /></p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="spring-ioc容器的核心接口" class="md-header-anchor"></a><span>Spring IOC容器的核心接口</span></h3><h4><a name="beanfactory" class="md-header-anchor"></a><span>BeanFactory</span></h4><p><strong><span>功能</span></strong><span>：</span></p><ol start='' ><li><span>提供IOC的配置机制</span></li><li><span>包含Bean的各种定义，便于实例Bean</span></li><li><span>Bean生命周期控制、Bean之间的依赖关系管理</span></li></ol><p>&nbsp;</p><h4><a name="beanfactory体系结构" class="md-header-anchor"></a><span>BeanFactory体系结构</span></h4><p><strong><span>ListableBeanFactory</span></strong><span>: 定义了访问容器中Bean基本信息的方法。</span>
<strong><span>HierarchicalBeanFactory</span></strong><span>: 定义访问父容器的方法。例如父容器不可访问子容器的Bean。SpringMVC是一个子容器可以看父容器[业务层]的Bean，但父容器不能查看SpringMVC的Bean。</span>
<strong><span>ConfigurableBeanFactory</span></strong><span>:  提供方法去配置BeanFactory。可设置类加载器、属性遍历器等。</span>
<strong><span>AutowireCapableBeanFactory</span></strong><span>: 定义Bean的自动匹配规则。</span></p><p><img src="img/BeanFactory体系.png" alt="image-20191012161544182" style="zoom:38%;" /></p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="applicationcontext" class="md-header-anchor"></a><span>ApplicationContext</span></h4><p><span>与BeanFactory对比: BeanFactory是Spring框架的基础；ApplicationContext是BeanFactory的子接口，具备更多的功能。</span></p><h3><a name="beandefinition" class="md-header-anchor"></a><span>BeanDefinition</span></h3><p><span>用来描述Bean的定义，对Bean的配置会转化成BeanDefinition对象。</span></p><h3><a name="beandefinitionregistry" class="md-header-anchor"></a><span>BeanDefinitionRegistry</span></h3><p><span>提供向IOC容器[BeanFactory]注册BeanDefinition对象的方法:</span></p><ol start='' ><li><span>(BeanName, BeanDefinition对象) 键值对 放到</span><strong><span>DefaultListableBeanFactory[BeanFactory的实现类]</span></strong><span>的</span><strong><span>beanDefinitionMap</span></strong><span>中。</span></li><li><span>BeanName全部放入</span><strong><span>beanDefinitionNames</span></strong><span>中。</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java "><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java "><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.32635498046875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">DefaultListableBeanFactory</span> <span class="cm-keyword">extends</span> <span class="cm-variable">AbstractAutowireCapableBeanFactory</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">implements</span> <span class="cm-variable">ConfigurableListableBeanFactory</span>, <span class="cm-variable">BeanDefinitionRegistry</span>, <span class="cm-variable">Serializable</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">private</span> <span class="cm-keyword">final</span> <span class="cm-variable">Map</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span> <span class="cm-variable">beanDefinitionMap</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ConcurrentHashMap</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">BeanDefinition</span><span class="cm-operator">&gt;</span>(<span class="cm-number">64</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">private</span> <span class="cm-keyword">final</span> <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">beanDefinitionNames</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ArrayList</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span>(<span class="cm-number">64</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 200px;"></div><div class="CodeMirror-gutters" style="display: none; height: 200px;"></div></div></div></pre><p>&nbsp;</p><h2><a name="spring-bean" class="md-header-anchor"></a><span>Spring Bean</span></h2><h3><a name="作用域" class="md-header-anchor"></a><span>作用域</span></h3><ol start='' ><li><span>singleton 默认作用域，单例</span></li><li><span>prototype 每次获取都会创建新的对象</span></li><li><span>request 每个HTTP请求都会创建一个新对象</span></li><li><span>session 每个会话都会创建一个新对象</span></li><li><span>globalSession </span></li></ol><h3><a name="bean生命周期" class="md-header-anchor"></a><span>Bean生命周期</span></h3><h4><a name="创建过程" class="md-header-anchor"></a><span>创建过程</span></h4><ol start='' ><li><span>实例化Bean</span></li><li><span>Aware [如果实现了Aware接口，注入BeanID、BeanFactory、ApplicationContext来获得IOC容器信息]</span></li><li><span>BeanPostProcessor的postProcessBeforeInitialization方法</span></li><li><span>InitializingBean的afterPropertiesSet方法</span></li><li><span>定制的Bean init方法</span></li><li><span>BeanPostProcessor的postProcessAfterInitialization方法</span></li><li><span>初始化完成</span></li></ol><h4><a name="销毁过程" class="md-header-anchor"></a><span>销毁过程</span></h4><ol start='' ><li><span>如果实现了DisposableBean接口，则调用destroy方法。</span></li><li><span>若配置了destroy-method属性，则调用配置的销毁方法。</span></li></ol><p>&nbsp;</p><h2><a name="spring-aop" class="md-header-anchor"></a><span>Spring AOP</span></h2><h3><a name="aop的3中织入方法" class="md-header-anchor"></a><span>AOP的3中织入方法</span></h3><ol start='' ><li><span>编译时织入: 需要特殊的编译器，AspectJ</span></li><li><span>类加载时织入: 同上</span></li><li><span>运行时织入: Spring采用的方式。通过动态代理[JDK动态代理/Cglib]实现。</span></li></ol><h3><a name="主要名词" class="md-header-anchor"></a><span>主要名词</span></h3><p><strong><span>Aspect</span></strong><span>: 通用功能代码。</span>
<strong><span>Target</span></strong><span>: 被织入Aspect的对象。</span>
<strong><span>Join Point</span></strong><span>: 可作为切入点的地方，所有方法都可以作为切入点。</span>
<strong><span>Pointcut</span></strong><span>: 切入点。定义Aspect被用在哪些Join Point切入点中。</span>
<strong><span>Advice</span></strong><span>: 通知方法。</span></p><p><strong><span>Advice的种类</span></strong><span>: Before、After、AfterReturning、AfterThrowing、Around</span></p><p>&nbsp;</p><h2><a name="spring-事务" class="md-header-anchor"></a><span>Spring 事务</span></h2><h3><a name="事务" class="md-header-anchor"></a><span>事务</span></h3><figure><table><thead><tr><th><span>常量</span></th><th><span>解释</span></th></tr></thead><tbody><tr><td><span>PROPAGATION_NEVER</span></td><td><span>不支持当前事务，存在则抛出异常</span></td></tr><tr><td><span>PROPAGATION_NOT_SUPPORTED</span></td><td><span>不支持当前事务，存在则挂起当前事务，以非事务运行</span></td></tr><tr><td><span>PROPAGATION_SUPPORTS</span></td><td><span>支持事务，没有则以非事务方式运行</span></td></tr><tr><td><span>PROPAGATION_MANDATORY</span></td><td><span>支持当前事务，没有则抛出异常</span></td></tr><tr><td><span>PROPAGATION_REQUIRED</span></td><td><span>支持当前事务，没有则新建事务，</span><strong><span>Spring默认</span></strong></td></tr><tr><td><span>PROPAGATION_REQUIRED_NEW</span></td><td><span>新建事务，如果当前存在事务，则把当前事务挂起。新建事务和被挂起事务是两个独立的事务</span></td></tr><tr><td><span>PROPAGATION_NESTED</span></td><td><span>有事务，则运行在一个嵌套事务中。没有，则新建一个事务</span></td></tr></tbody></table></figure><p>&nbsp;</p><h3><a name="隔离级别" class="md-header-anchor"></a><span>隔离级别</span></h3><figure><table><thead><tr><th><span>常量</span></th><th><span>解释</span></th></tr></thead><tbody><tr><td><span>ISOLATION_DEFAULT</span></td><td><span>使用平台默认的隔离级别</span></td></tr><tr><td><span>ISOLATION_READ_UNCOMMITTED</span></td><td><span>允许读取未提交数据</span></td></tr><tr><td><span>ISOLATION_READ_COMMITTED</span></td><td><span>只能读取提交了的数据</span></td></tr><tr><td><span>ISOLATION_REPEATABLE_READ</span></td><td><span>可重复读</span></td></tr><tr><td><span>ISOLATION_SERIALIZABLE</span></td><td><span>事务按顺序执行</span></td></tr></tbody></table></figure><p>&nbsp;</p><h1><a name="linux" class="md-header-anchor"></a><span>Linux</span></h1><h2><a name="查找文件命令-find" class="md-header-anchor"></a><span>查找文件命令 find</span></h2><h2><a name="管道操作符-" class="md-header-anchor"></a><span>管道操作符 |</span></h2><p><span>cmd1|cmd2|cmd3</span></p><p><span>管道左边的输出作为右边的输入</span></p><h2><a name="筛选内容命令-grep" class="md-header-anchor"></a><span>筛选内容命令 grep</span></h2><h3><a name="-o-pattern-不显示整行只显示匹配区域的内容" class="md-header-anchor"></a><span>-o &quot;pattern&quot; 不显示整行，只显示匹配区域的内容</span></h3><h3><a name="-v-pattern-过滤匹配的行不显示" class="md-header-anchor"></a><span>-v &quot;pattern&quot; 过滤匹配的行不显示</span></h3><h2><a name="awk" class="md-header-anchor"></a><span>awk </span></h2><p><span>适合处理格式化的内容，可做统计。</span></p><p><span>一次读取一行，按分隔符进行切片，切成多个部分放入内建变量中</span><span>$</span><span>1,</span><span>$</span><span>2,...</span><span>$</span><span>n，</span><span>$</span><span>0表示整行数据</span></p><h2><a name="sed" class="md-header-anchor"></a><span>sed</span></h2><p><span>流编辑器，适合用正则表达式处理内容，批量替换、修改。</span></p><h2><a name="pipeline" class="md-header-anchor"></a><span>pipeline</span></h2><p>&nbsp;</p><p>&nbsp;</p><h1><a name="redis" class="md-header-anchor"></a><span>Redis</span></h1><h2><a name="面试题-n1606" class="md-header-anchor"></a><span>面试题</span></h2><h3><a name="海量key中查询出某一个固定前缀的key" class="md-header-anchor"></a><span>海量key中查询出某一个固定前缀的key</span></h3><ol start='' ><li><span>keys 一次性返回所有匹配的结果，数据量大会卡顿</span></li><li><span>scan 一次返回部分结果</span></li></ol><h3><a name="如何通过redis实现分布式锁" class="md-header-anchor"></a><span>如何通过Redis实现分布式锁</span></h3><h4><a name="setnx" class="md-header-anchor"></a><span>setnx</span></h4><p><strong><span>setnx key value</span></strong><span>:</span>
<span>如果key不存在，则创建，返回1。存在则返回0。</span>
<span>时间复杂度: O(1)</span></p><p>&nbsp;</p><p><strong><span>实现</span></strong><span>: 加锁和解锁非原子性操作，容易发生问题。如解锁前程序挂了，就无法解锁。</span>
<strong><span>加锁</span></strong><span>: setnx key value</span>
<strong><span>解锁</span></strong><span>: 设置过期时间 expire key time</span></p><h4><a name="set" class="md-header-anchor"></a><span>set</span></h4><p><span>set key value [ex seconds] [px milliseconds] [nx|xx]:</span>
<strong><span>ex seconds</span></strong><span>: 过期时间 单位秒</span>
<strong><span>px milliseconds</span></strong><span>: 过期时间 单位毫秒</span>
<strong><span>nx</span></strong><span>: 只在键</span><strong><span>不存在</span></strong><span>时进行设置</span>
<strong><span>xx</span></strong><span>: 只在键</span><strong><span>存在</span></strong><span>时进行设置</span>
<strong><span>返回</span></strong><span>: 成功OK，否则nil</span></p><h3><a name="大量key同时过期" class="md-header-anchor"></a><span>大量key同时过期</span></h3><p><strong><span>问题</span></strong><span>: 集中过期，清除大量key耗时，会出现卡顿</span>
<strong><span>解决</span></strong><span>: 过期时间加个随机值</span></p><p>&nbsp;</p><h3><a name="如何hs用redis做异步队列" class="md-header-anchor"></a><span>如何hs用Redis做异步队列</span></h3><h4><a name="rpushlpopblpop" class="md-header-anchor"></a><span>rpush+lpop/blpop</span></h4><p><span>使用List作为队列。rpush生产消息，lpop/blpop消费消息。</span>
<span>lpop: 队列空不阻塞</span>
<span>blpop: 队列空则阻塞，直到有消息或超时。</span></p><p><strong><span>缺点</span></strong><span>: 只能有一个消费者消费，因为lpop/blpop之后消息就没了</span></p><p>&nbsp;</p><h4><a name="publish-subscribe" class="md-header-anchor"></a><span>publish subscribe</span></h4><p><span>发布订阅模式。发送者publish发送消息，订阅者subscribe接受消息。</span>
<span>订阅者可以订阅多个频道。</span>
<img src="img/pubsub.png" alt="image-20191014102810119" style="zoom:20%;" /></p><p><strong><span>缺点</span></strong><span>: 消息发布无状态，无法保证消息送达。如订阅者下线后无法收到消息。此时应使用专业的消息队列kafka</span></p><p>&nbsp;</p><h3><a name="redis如何做持久化" class="md-header-anchor"></a><span>Redis如何做持久化</span></h3><h4><a name="rdb-快照持久化" class="md-header-anchor"></a><span>RDB 快照持久化</span></h4><p><span>save: 阻塞Redis服务器进程，直到RDB文件创建完成。</span>
<span>bgsave: fork出一个子进程来创建RDB，非阻塞。若有AOF或RDB在进行，则返回错误</span></p><p><strong><span>RDB触发点</span></strong><span>:</span>
<span>根据redis.conf配置save m n [其实用的是bgsave]</span>
<span>主从复制的时候，主节点自动触发</span>
<span>执行debug reload</span>
<span>执行shutdown且没有开启AOF持久化</span></p><p><strong><span>缺点</span></strong><span>: </span>
<span>同步的是全部数据，数据量大时会影响性能。</span>
<span>Redis挂掉可能会丢失数据，因为还未触发RDB。</span></p><h4><a name="aof-保存写状态持久化" class="md-header-anchor"></a><span>AOF 保存写状态持久化</span></h4><p><span>Appedn-Only-File[AOF]: 记录所有除查询以外的写操作指令。以append的形式追加到AOF文件后面。</span></p><p><span>AOF文件过大，日志会重写以精简AOF文件:</span>
<span>调用fork，创建一个子进程把AOF写到临时文件中，不依赖原有的AOF文件，主进程将新的变动写到临时文件和原AOF文件中。完成重写后替换原AOF文件。</span></p><h4><a name="rdb-aof混合持久化方式" class="md-header-anchor"></a><span>RDB-AOF混合持久化方式</span></h4><p><span>bgsave做全量持久化，aof做增量持久化。</span></p><h4><a name="redis-数据恢复" class="md-header-anchor"></a><span>Redis 数据恢复</span></h4><p><span>启动时，恢复数据，有AOF则忽略RDB。</span></p><h4><a name="rdb-aof优缺点" class="md-header-anchor"></a><span>RDB AOF优缺点</span></h4><p><span>RDB优点 全部数据快照，文件小，恢复快。</span>
<span>RDB缺点 无法保存最近一次快照之后的数据。</span></p><p><span>AOF优点 可读性高，数据不已丢失。</span>
<span>AOF缺点 文件体积大，恢复时间长。</span></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h2><a name="memcache和redis区别" class="md-header-anchor"></a><span>Memcache和Redis区别</span></h2><p><strong><span>Memcache</span></strong><span>:</span></p><p><span>代码层次类似Hash</span></p><ol start='' ><li><span>支持简单数据类型</span></li><li><span>不支持数据持久化存储</span></li><li><span>不支持主从</span></li><li><span>不支持分片</span></li></ol><p><strong><span>Redis</span></strong><span>:</span></p><ol start='' ><li><span>数据类型丰富</span></li><li><span>支持持久化存储</span></li><li><span>支持主从</span></li><li><span>支持分片</span></li></ol><h2><a name="为什么redis这么快" class="md-header-anchor"></a><span>为什么Redis这么快</span></h2><ol start='' ><li><span>基于内存</span></li><li><span>数据结构简单</span></li><li><span>单线程</span></li><li><span>多路复用IO</span></li></ol><h2><a name="file-descriptor-fd" class="md-header-anchor"></a><span>File Descriptor [FD]</span></h2><p><span>文件描述符</span></p><p>&nbsp;</p><h2><a name="数据类型" class="md-header-anchor"></a><span>数据类型</span></h2><ol start='' ><li><span>String</span></li><li><span>Hash</span></li><li><span>List</span></li><li><span>Set</span></li><li><span>Sorted Set</span></li></ol><h2><a name="命令" class="md-header-anchor"></a><span>命令</span></h2><h3><a name="key相关" class="md-header-anchor"></a><span>key相关</span></h3><p><span>del key</span>
<span>dump key</span>
<span>exists key</span>
<span>expire key seconds</span>
<span>ttl key</span>
<span>type key</span></p><h3><a name="string-相关" class="md-header-anchor"></a><span>String 相关</span></h3><p><span>set key value</span>
<span>mset k1 v1 [k2 v2 k3 v3...]</span>
<span>setnx key value</span></p><p><span>get key</span>
<span>mget key1 [key2 key3...]</span></p><p><span>getset key value</span></p><p><span>Incr key</span>
<span>incrby key increment</span>
<span>decr key</span>
<span>decrby key decrement</span></p><p><span>strlen key</span></p><h3><a name="hash-相关" class="md-header-anchor"></a><span>hash 相关</span></h3><p><span>hset key k1 v1 [k2 v2 ...]</span></p><p><span>hdel key kn</span></p><p><span>hget key kn</span>
<span>hgetall key</span></p><p><span>hlen key</span></p><h3><a name="list-相关" class="md-header-anchor"></a><span>list 相关</span></h3><p><span>lpush/rpush key value</span></p><p><span>lpop/rpop/blpop/brpop key </span></p><h3><a name="set相关" class="md-header-anchor"></a><span>set相关</span></h3><p><span>sadd key v1 [v2,v3...]</span></p><p><span>smembers key</span>
<span>sismember key vn</span></p><p><span>spop key</span>
<span>srem key vn [v...]</span></p><p><span>sinter k1 [k2 ...]</span>
<span>sunion k1 [k2 ...]</span>
<span>sdiff k1 [k2 ...]</span></p><p><span>scard key</span></p><h3><a name="sorted-set相关" class="md-header-anchor"></a><span>sorted set相关</span></h3><p><span>zadd key score1 member1 [score2 member2]</span></p><p><span>zcard key</span></p><p>&nbsp;</p><h1><a name="maven" class="md-header-anchor"></a><span>Maven</span></h1><h2><a name="生命周期" class="md-header-anchor"></a><span>生命周期</span></h2><p><span>validate</span>
<span>compile</span>
<span>test</span>
<span>package</span>
<span>verify</span>
<span>install</span>
<span>deploy</span></p><p>&nbsp;</p></div>
</body>
</html>